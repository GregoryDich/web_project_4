!function(){"use strict";class e{constructor(e,t){let{data:s,handleCardClick:n,handleCardDelete:r,handleCardLike:i}=e;this._template=t,this._name=s.name,this._link=s.link,this._handleCardClick=n,this._handleCardLike=i,this._handleCardDelete=r,this._likes=s.likes,this._owner=s.owner._id,this._id=s._id}_handleDeleteButtonVisibility(e){this._owner!==e._id&&(this._deleteButton.style.display="none")}deleteCard(){this._cardElement.remove()}updateLikes(e){this._likeCounter.textContent=e.likes.length,this._likeButton.classList.toggle("card__like-button_active")}getLikesCount(e){this._likes.some((t=>t._id===e._id))&&this._likeButton.classList.add("card__like-button_active"),this._likeCounter.textContent=this._likes.length<1?"":this._likes.length}_getTemplate(){return this._cardElement=this._template.querySelector(".card").cloneNode(!0),this._cardElement}_handleLikeButton(){const e=this._likeButton.classList.contains("card__like-button_active");this._handleCardLike(e,this)}_setEventListeners(){this._likeButton.addEventListener("click",(()=>{this._handleLikeButton()})),this._deleteButton.addEventListener("click",(()=>{this._handleCardDelete(this)})),this._cardPicture.addEventListener("click",(()=>this._handleCardClick({name:this._name,link:this._link})))}generateCard(e){return this._card=this._getTemplate(),this._cardPicture=this._card.querySelector(".card__image"),this._cardPicture.src=this._link,this._deleteButton=this._card.querySelector(".card__delete-button"),this._likeCounter=this._card.querySelector(".card__like-counter"),this._likeButton=this._card.querySelector(".card__like-button"),this.getLikesCount(e),this._handleDeleteButtonVisibility(e),this._cardPicture.alt=this._name+" photo",this._card.querySelector(".card__description").textContent=this._name,this._setEventListeners(e),this._card}}class t{constructor(e,t){this._settings=t,this._form=e}_showInputError(e){this._error=this._form.querySelector(".".concat(e.name,"-input-error")),e.classList.add(this._settings.inputErrorClass),this._error.classList.add(this._settings.errorClass),this._error.textContent=e.validationMessage}_hideInputError(e){this._error=this._form.querySelector(".".concat(e.name,"-input-error")),e.classList.remove(this._settings.inputErrorClass),this._error.classList.remove(this._settings.errorClass),this._error.textContent=""}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}toggleButtonState(){this._hasInvalidInput(this._inputs)?(this._button.classList.add(this._settings.inactiveButtonClass),this._button.disabled=!0):(this._button.classList.remove(this._settings.inactiveButtonClass),this._button.disabled=!1)}_setEventListeners(){this._button=this._form.querySelector(this._settings.submitButtonSelector),this._inputs=Array.from(this._form.querySelectorAll(this._settings.inputSelector)),this.toggleButtonState(),this._inputs.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this.toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}class s{constructor(e){var t,s;s=e=>{"Escape"===e.key&&this.close()},(t="_handleEscClose")in this?Object.defineProperty(this,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[t]=s,this._popup=document.querySelector(e)}handleButtonText(e){this._popup.querySelector(".popup__button").textContent=e}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popup.addEventListener("click",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class n extends s{constructor(e,t){super(e),this._handleSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._data={},this._inputs=this._popup.querySelectorAll(".popup__form-input")}_getInputValues(){return this._inputs.forEach((e=>{this._data[e.name]=e.value})),this._data}close(){super.close(),this._form.reset()}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(e=>{this._data=this._getInputValues(),e.preventDefault(),this._handleSubmit(this._data)}))}}var r={formSelector:".popup__form",inputSelector:".popup__form-input",submitButtonSelector:".popup__form-button",inactiveButtonClass:"popup__form-button_disabled",inputErrorClass:"popup__form-input_type_error",errorClass:"popup__error_active"};const i=document.querySelector(".user__edit-button"),a=document.querySelector(".popup__form-input_type_name"),o=document.querySelector(".popup__form-input_type_profession"),l=document.querySelector(".popup__form_type_profile"),h=document.querySelector(".popup__form_type_place"),c=document.querySelector(".popup__form_type_avatar"),_=document.querySelector(".user__add-button"),d=document.querySelector(".user__avatar-overlay"),u=document.querySelector("#template").content;let p={};new t(l,r).enableValidation();const m=new t(h,r);m.enableValidation();const v=new t(c,r);v.enableValidation();const f=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}addLike(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e._id),{method:"PUT",headers:this._headers}).then((e=>this._checkResponse(e)))}removeLike(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e._id),{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e)))}editAvatar(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatar})}).then((e=>this._checkResponse(e)))}editProfile(e){return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.profession})}).then((e=>this._checkResponse(e)))}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e._id),{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e)))}addCard(e){return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.place,link:e.url})}).then((e=>this._checkResponse(e)))}getUserInfo(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>this._checkResponse(e)))}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((e=>this._checkResponse(e)))}_checkResponse(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"545ebbe5-83ef-479f-9e3a-79ad4591aa10","Content-Type":"application/json"}}),k=new n(".popup_type_profile",(function(e){k.handleButtonText("Saving..."),f.editProfile(e).then((e=>{S.setUserInfo(e),k.close()})).catch((e=>console.log(e))).finally((()=>{k.handleButtonText("Save")}))}));k.setEventListeners();const y=new class extends s{constructor(e,t){super(e),this._handleSubmit=t,this._form=this._popup.querySelector(".popup__form")}openForDelete(e){return super.open(),e&&(this._data=e),this._data}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit(this._data)}))}}(".popup_type_delete",(function(e){y.handleButtonText("Saving..."),f.deleteCard(e).then((t=>{e.deleteCard(),y.close()})).catch((e=>console.log(e))).finally((()=>{y.handleButtonText("Yes")}))}));y.setEventListeners();const g=new n(".popup_type_place",(function(e){g.handleButtonText("Saving..."),f.addCard(e).then((e=>{L.addItem(e),g.close()})).catch((e=>console.log(e))).finally((()=>{g.handleButtonText("Save")}))}));g.setEventListeners();const b=new n(".popup_type_avatar",(function(e){b.handleButtonText("Saving..."),f.editAvatar(e).then((e=>{S.setUserAvatar(e.avatar),b.close()})).catch((e=>console.log(e))).finally((()=>{b.handleButtonText("Save")}))}));b.setEventListeners();const C=new class extends s{open(e){let{name:t,link:s}=e;super.open(),this._picture=this._popup.querySelector(".popup__image"),this._picture.src=s,this._picture.alt=t+" photo",this._title=this._popup.querySelector(".popup__image-title"),this._title.textContent=t}}(".popup_type_image");C.setEventListeners();const L=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}addItem(e){const t=this._renderer(e);this._container.prepend(t)}renderItems(e){Array.from(e).forEach((e=>{this.addItem(e)}))}}({renderer:t=>function(t){let{item:s}=t;return new e({data:s,handleCardClick:e=>{let{name:t,link:s}=e;C.open({name:t,link:s})},handleCardDelete:e=>{y.openForDelete(e)},handleCardLike:(e,t)=>{e?f.removeLike(t).then((e=>{t.updateLikes(e)})).catch((e=>console.log(e))):f.addLike(t).then((e=>{t.updateLikes(e)})).catch((e=>console.log(e)))}},u).generateCard(p)}({item:t})},".gallery"),S=new class{constructor(e){let{name:t,info:s,avatar:n}=e;this._name=document.querySelector(t),this._about=document.querySelector(s),this._avatar=document.querySelector(n)}setUserAvatar(e){this._avatar.src=e}getUserInfo(){return this._data={name:this._name.textContent,about:this._about.textContent},this._data}setUserInfo(e){this._name.textContent=e.name,this._about.textContent=e.about}}({name:".user__name",info:".user__profession",avatar:".user__avatar-image"});Promise.all([f.getUserInfo(),f.getInitialCards()]).then((e=>{let[t,s]=e;p=t,S.setUserInfo(t),S.setUserAvatar(t.avatar),L.renderItems(s)})).catch((e=>console.log(e))),i.addEventListener("click",(()=>{k.open();const e=S.getUserInfo();a.value=e.name,o.value=e.about})),_.addEventListener("click",(()=>{g.open(),m.toggleButtonState()})),d.addEventListener("click",(()=>{b.open(),v.toggleButtonState()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVFtQyxJQUFJLENBQUMvRCxFQUFJd0IsY0FBZXhCLEVBQUl5QixvQkFDakNoQixNQUFLLElBQW1CLElBQWpCNUcsRUFBTW1LLEdBQVcsRUFDdkJwRSxFQUFjL0YsRUFDZG9JLEVBQVNDLFlBQVlySSxHQUNyQm9JLEVBQVNjLGNBQWNsSixFQUFLb0gsUUFDNUIyQixFQUFZYSxZQUFZTyxNQUV6QjdCLE9BQU9DLEdBQVFDLFFBQVFDLElBQUlGLEtBeUY5QmxELEVBQVczRCxpQkFBaUIsU0FBUyxLQUNuQ3lHLEVBQXFCNUQsT0FDckIsTUFBTTZGLEVBQVdoQyxFQUFTVCxjQUMxQnJDLEVBQVVKLE1BQVFrRixFQUFTaEwsS0FDM0JtRyxFQUFVTCxNQUFRa0YsRUFBUzlDLFNBRTdCM0IsRUFBZWpFLGlCQUFpQixTQUFTLEtBQ3ZDb0gsRUFBcUJ2RSxPQUNyQjBCLEVBQWVoRCx1QkFFakIyQyxFQUFpQmxFLGlCQUFpQixTQUFTLEtBQ3pDdUgsRUFBd0IxRSxPQUN4QjJCLEVBQWdCakQsdUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hcm91bmR1cy8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vYXJvdW5kdXMvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL2Fyb3VuZHVzLy4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vYXJvdW5kdXMvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL2Fyb3VuZHVzLy4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL2Fyb3VuZHVzLy4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly9hcm91bmR1cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9hcm91bmR1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwRm9yRGVsZXRlLmpzIiwid2VicGFjazovL2Fyb3VuZHVzLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vYXJvdW5kdXMvLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL2Fyb3VuZHVzLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHsgZGF0YSwgaGFuZGxlQ2FyZENsaWNrLCBoYW5kbGVDYXJkRGVsZXRlLCBoYW5kbGVDYXJkTGlrZSB9LFxuICAgIHRlbXBsYXRlXG4gICkge1xuICAgIHRoaXMuX3RlbXBsYXRlID0gdGVtcGxhdGU7XG4gICAgdGhpcy5fbmFtZSA9IGRhdGEubmFtZTtcbiAgICB0aGlzLl9saW5rID0gZGF0YS5saW5rO1xuICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayA9IGhhbmRsZUNhcmRDbGljaztcbiAgICB0aGlzLl9oYW5kbGVDYXJkTGlrZSA9IGhhbmRsZUNhcmRMaWtlO1xuICAgIHRoaXMuX2hhbmRsZUNhcmREZWxldGUgPSBoYW5kbGVDYXJkRGVsZXRlO1xuICAgIHRoaXMuX2xpa2VzID0gZGF0YS5saWtlcztcbiAgICB0aGlzLl9vd25lciA9IGRhdGEub3duZXIuX2lkO1xuICAgIHRoaXMuX2lkID0gZGF0YS5faWQ7XG4gIH1cbiAgX2hhbmRsZURlbGV0ZUJ1dHRvblZpc2liaWxpdHkodXNlcikge1xuICAgIGlmICh0aGlzLl9vd25lciAhPT0gdXNlci5faWQpIHtcbiAgICAgIHRoaXMuX2RlbGV0ZUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgfVxuICB9XG4gIGRlbGV0ZUNhcmQoKSB7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnQucmVtb3ZlKCk7XG4gIH1cbiAgdXBkYXRlTGlrZXMocmVzKSB7XG4gICAgdGhpcy5fbGlrZUNvdW50ZXIudGV4dENvbnRlbnQgPSByZXMubGlrZXMubGVuZ3RoO1xuICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgfVxuICBnZXRMaWtlc0NvdW50KHVzZXIpIHtcbiAgICB0aGlzLl9saWtlcy5zb21lKChlbCkgPT4gZWwuX2lkID09PSB1c2VyLl9pZCkgJiZcbiAgICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgICB0aGlzLl9saWtlQ291bnRlci50ZXh0Q29udGVudCA9XG4gICAgICB0aGlzLl9saWtlcy5sZW5ndGggPCAxID8gXCJcIiA6IHRoaXMuX2xpa2VzLmxlbmd0aDtcbiAgfVxuICBfZ2V0VGVtcGxhdGUoKSB7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnQgPSB0aGlzLl90ZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIikuY2xvbmVOb2RlKHRydWUpO1xuICAgIHJldHVybiB0aGlzLl9jYXJkRWxlbWVudDtcbiAgfVxuICBfaGFuZGxlTGlrZUJ1dHRvbigpIHtcbiAgICBjb25zdCBpc0xpa2VkID0gdGhpcy5fbGlrZUJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoXG4gICAgICBcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiXG4gICAgKTtcbiAgICB0aGlzLl9oYW5kbGVDYXJkTGlrZShpc0xpa2VkLCB0aGlzKTtcbiAgfVxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fbGlrZUJ1dHRvblxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuX2hhbmRsZUxpa2VCdXR0b24oKTtcbiAgICAgIH0pO1xuICAgIHRoaXMuX2RlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5faGFuZGxlQ2FyZERlbGV0ZSh0aGlzKTtcbiAgICB9KTtcbiAgICB0aGlzLl9jYXJkUGljdHVyZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cbiAgICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayh7XG4gICAgICAgIG5hbWU6IHRoaXMuX25hbWUsXG4gICAgICAgIGxpbms6IHRoaXMuX2xpbmssXG4gICAgICB9KVxuICAgICk7XG4gIH1cbiAgZ2VuZXJhdGVDYXJkKHVzZXIpIHtcbiAgICB0aGlzLl9jYXJkID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcbiAgICB0aGlzLl9jYXJkUGljdHVyZSA9IHRoaXMuX2NhcmQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgICB0aGlzLl9jYXJkUGljdHVyZS5zcmMgPSB0aGlzLl9saW5rO1xuICAgIHRoaXMuX2RlbGV0ZUJ1dHRvbiA9IHRoaXMuX2NhcmQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpO1xuICAgIHRoaXMuX2xpa2VDb3VudGVyID0gdGhpcy5fY2FyZC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtY291bnRlclwiKTtcbiAgICB0aGlzLl9saWtlQnV0dG9uID0gdGhpcy5fY2FyZC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuICAgIHRoaXMuZ2V0TGlrZXNDb3VudCh1c2VyKTtcbiAgICB0aGlzLl9oYW5kbGVEZWxldGVCdXR0b25WaXNpYmlsaXR5KHVzZXIpO1xuICAgIHRoaXMuX2NhcmRQaWN0dXJlLmFsdCA9IHRoaXMuX25hbWUgKyBcIiBwaG90b1wiO1xuICAgIHRoaXMuX2NhcmQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZXNjcmlwdGlvblwiKS50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnModXNlcik7XG4gICAgcmV0dXJuIHRoaXMuX2NhcmQ7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICBjb25zdHJ1Y3Rvcihmb3JtLCBzZXR0aW5ncykge1xuICAgIHRoaXMuX3NldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgdGhpcy5fZm9ybSA9IGZvcm07XG4gIH1cbiAgX3Nob3dJbnB1dEVycm9yKGlucHV0KSB7XG4gICAgdGhpcy5fZXJyb3IgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0Lm5hbWV9LWlucHV0LWVycm9yYCk7XG4gICAgaW5wdXQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xuICAgIHRoaXMuX2Vycm9yLmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuZXJyb3JDbGFzcyk7XG4gICAgdGhpcy5fZXJyb3IudGV4dENvbnRlbnQgPSBpbnB1dC52YWxpZGF0aW9uTWVzc2FnZTtcbiAgfVxuICBfaGlkZUlucHV0RXJyb3IoaW5wdXQpIHtcbiAgICB0aGlzLl9lcnJvciA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihgLiR7aW5wdXQubmFtZX0taW5wdXQtZXJyb3JgKTtcbiAgICBpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XG4gICAgdGhpcy5fZXJyb3IuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5lcnJvckNsYXNzKTtcbiAgICB0aGlzLl9lcnJvci50ZXh0Q29udGVudCA9IFwiXCI7XG4gIH1cbiAgX2hhc0ludmFsaWRJbnB1dChpbnB1dHMpIHtcbiAgICByZXR1cm4gaW5wdXRzLnNvbWUoKGlucHV0KSA9PiB7XG4gICAgICByZXR1cm4gIWlucHV0LnZhbGlkaXR5LnZhbGlkO1xuICAgIH0pO1xuICB9XG4gIF9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXQpIHtcbiAgICBpZiAoaW5wdXQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXQpO1xuICAgIH1cbiAgfVxuICB0b2dnbGVCdXR0b25TdGF0ZSgpIHtcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KHRoaXMuX2lucHV0cykpIHtcbiAgICAgIHRoaXMuX2J1dHRvbi5jbGFzc0xpc3QuYWRkKHRoaXMuX3NldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgdGhpcy5fYnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICB0aGlzLl9idXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2J1dHRvbiA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihcbiAgICAgIHRoaXMuX3NldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXG4gICAgKTtcbiAgICB0aGlzLl9pbnB1dHMgPSBBcnJheS5mcm9tKFxuICAgICAgdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX3NldHRpbmdzLmlucHV0U2VsZWN0b3IpXG4gICAgKTtcbiAgICB0aGlzLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgdGhpcy5faW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXQpO1xuICAgICAgICB0aGlzLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9wb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XG4gIH1cbiAgaGFuZGxlQnV0dG9uVGV4dCh0ZXh0KSB7XG4gICAgY29uc3QgYnV0dG9uID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24nKTtcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSB0ZXh0O1xuICB9XG4gIG9wZW4oKSB7XG4gICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5lZFwiKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gIH1cbiAgY2xvc2UoKSB7XG4gICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShcInBvcHVwX29wZW5lZFwiKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gIH1cbiAgX2hhbmRsZUVzY0Nsb3NlID0gKGV2dCkgPT4ge1xuICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9O1xuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9wb3B1cC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX29wZW5lZFwiKSB8fFxuICAgICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX19jbG9zZS1idXR0b25cIilcbiAgICAgICkge1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVTdWJtaXQpIHtcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICB0aGlzLl9oYW5kbGVTdWJtaXQgPSBoYW5kbGVTdWJtaXQ7XG4gICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1cIik7XG4gICAgdGhpcy5fZGF0YSA9IHt9O1xuICAgIHRoaXMuX2lucHV0cyA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBfX2Zvcm0taW5wdXRcIik7XG4gIH1cbiAgX2dldElucHV0VmFsdWVzKCkge1xuICAgIHRoaXMuX2lucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgdGhpcy5fZGF0YVtpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xuICAgIH0pO1xuICAgIHJldHVybiB0aGlzLl9kYXRhO1xuICB9XG4gIGNsb3NlKCkge1xuICAgIHN1cGVyLmNsb3NlKCk7XG4gICAgdGhpcy5fZm9ybS5yZXNldCgpO1xuICB9XG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICB0aGlzLl9kYXRhID0gdGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKTtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5faGFuZGxlU3VibWl0KHRoaXMuX2RhdGEpO1xuICAgIH0pO1xuICB9XG59XG4iLCJjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xuICB9XG4gIGFkZExpa2UoY2FyZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmQuX2lkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcykpO1xuICB9XG4gIHJlbW92ZUxpa2UoY2FyZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmQuX2lkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcykpO1xuICB9XG4gIGVkaXRBdmF0YXIodmFsdWVzKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgYXZhdGFyOiB2YWx1ZXMuYXZhdGFyLFxuICAgICAgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcykpO1xuICB9XG4gIGVkaXRQcm9maWxlKHZhbHVlcykge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZTogdmFsdWVzLm5hbWUsXG4gICAgICAgIGFib3V0OiB2YWx1ZXMucHJvZmVzc2lvbixcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpKTtcbiAgfVxuICBkZWxldGVDYXJkKGNhcmQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkLl9pZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpKTtcbiAgfVxuICBhZGRDYXJkKHZhbHVlcykge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lOiB2YWx1ZXMucGxhY2UsXG4gICAgICAgIGxpbms6IHZhbHVlcy51cmwsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKSk7XG4gIH1cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKSk7XG4gIH1cblxuICBfY2hlY2tSZXNwb25zZShyZXMpIHtcbiAgICBpZiAocmVzLm9rKSB7XG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICB9XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICB9XG59XG5leHBvcnQgZGVmYXVsdCBBcGk7XG4iLCJjb25zdCB2YWxpZGF0ZVNlbGVjdG9ycyA9IHtcbiAgICBmb3JtU2VsZWN0b3I6IFwiLnBvcHVwX19mb3JtXCIsXG4gICAgaW5wdXRTZWxlY3RvcjogXCIucG9wdXBfX2Zvcm0taW5wdXRcIixcbiAgICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIucG9wdXBfX2Zvcm0tYnV0dG9uXCIsXG4gICAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fZm9ybS1idXR0b25fZGlzYWJsZWRcIixcbiAgICBpbnB1dEVycm9yQ2xhc3M6IFwicG9wdXBfX2Zvcm0taW5wdXRfdHlwZV9lcnJvclwiLFxuICAgIGVycm9yQ2xhc3M6IFwicG9wdXBfX2Vycm9yX2FjdGl2ZVwiLFxuICB9O1xuICBleHBvcnQgZGVmYXVsdCB2YWxpZGF0ZVNlbGVjdG9ycztcblxuXG4gIC8vdmFyaWFibGVzXG5cbmNvbnN0IGVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnVzZXJfX2VkaXQtYnV0dG9uXCIpO1xuY29uc3QgbmFtZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybS1pbnB1dF90eXBlX25hbWVcIik7XG5jb25zdCBwcm9mSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtLWlucHV0X3R5cGVfcHJvZmVzc2lvblwiKTtcbmNvbnN0IGZvcm1Vc2VyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1fdHlwZV9wcm9maWxlXCIpO1xuY29uc3QgZm9ybVBsYWNlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1fdHlwZV9wbGFjZVwiKTtcbmNvbnN0IGZvcm1BdmF0YXJFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybV90eXBlX2F2YXRhclwiKTtcbmNvbnN0IGFkZFBsYWNlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi51c2VyX19hZGQtYnV0dG9uXCIpO1xuY29uc3QgZWRpdEF2YXRhckJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudXNlcl9fYXZhdGFyLW92ZXJsYXlcIik7XG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3RlbXBsYXRlXCIpLmNvbnRlbnQ7XG5cbmV4cG9ydCB7IGVkaXRCdXR0b24sIG5hbWVJbnB1dCwgcHJvZklucHV0LCBmb3JtVXNlckVsZW1lbnQsIGZvcm1QbGFjZUVsZW1lbnQsIGZvcm1BdmF0YXJFbGVtZW50LCBhZGRQbGFjZUJ1dHRvbiwgZWRpdEF2YXRhckJ1dHRvbiwgY2FyZFRlbXBsYXRlIH07IiwiLy9pbXBvcnRzXG5cbmltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xuaW1wb3J0IFBvcHVwRm9yRGVsZXRlIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwRm9yRGVsZXRlLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xuaW1wb3J0IHZhbGlkYXRlU2VsZWN0b3JzIGZyb20gXCIuLi91dGlscy9jb25zdGFudHNcIjtcbmltcG9ydCB7XG4gIGVkaXRCdXR0b24sXG4gIG5hbWVJbnB1dCxcbiAgcHJvZklucHV0LFxuICBmb3JtVXNlckVsZW1lbnQsXG4gIGZvcm1QbGFjZUVsZW1lbnQsXG4gIGZvcm1BdmF0YXJFbGVtZW50LFxuICBhZGRQbGFjZUJ1dHRvbixcbiAgZWRpdEF2YXRhckJ1dHRvbixcbiAgY2FyZFRlbXBsYXRlLFxufSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzXCI7XG5cbmxldCBjdXJyZW50VXNlciA9IHt9O1xuLy92YWxpZGF0b3JzXG5cbmNvbnN0IHByb2ZpbGVWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihmb3JtVXNlckVsZW1lbnQsIHZhbGlkYXRlU2VsZWN0b3JzKTtcbnByb2ZpbGVWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBwbGFjZVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1QbGFjZUVsZW1lbnQsIHZhbGlkYXRlU2VsZWN0b3JzKTtcbnBsYWNlVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuY29uc3QgYXZhdGFyVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUF2YXRhckVsZW1lbnQsIHZhbGlkYXRlU2VsZWN0b3JzKTtcbmF2YXRhclZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbi8vY2xhc3MgaW5zdGFuY2VzXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2NvaG9ydC0zLWVuXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjU0NWViYmU1LTgzZWYtNDc5Zi05ZTNhLTc5YWQ0NTkxYWExMFwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmNvbnN0IHBvcHVwV2l0aFByb2ZpbGVGb3JtID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gIFwiLnBvcHVwX3R5cGVfcHJvZmlsZVwiLFxuICBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdFxuKTtcbnBvcHVwV2l0aFByb2ZpbGVGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IHBvcHVwV2l0aERlbGV0ZUZvcm0gPSBuZXcgUG9wdXBGb3JEZWxldGUoXG4gIFwiLnBvcHVwX3R5cGVfZGVsZXRlXCIsXG4gIGhhbmRsZURlbGV0ZUZvcm1TdWJtaXRcbik7XG5wb3B1cFdpdGhEZWxldGVGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IHBvcHVwV2l0aEFkZENhcmRGb3JtID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gIFwiLnBvcHVwX3R5cGVfcGxhY2VcIixcbiAgaGFuZGxlUGxhY2VGb3JtU3VibWl0XG4pO1xucG9wdXBXaXRoQWRkQ2FyZEZvcm0uc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3QgcG9wdXBXaXRoRWRpdEF2YXRhckZvcm0gPSBuZXcgUG9wdXBXaXRoRm9ybShcbiAgXCIucG9wdXBfdHlwZV9hdmF0YXJcIixcbiAgaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdFxuKTtcbnBvcHVwV2l0aEVkaXRBdmF0YXJGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IHBvcHVwV2l0aEltYWdlID0gbmV3IFBvcHVwV2l0aEltYWdlKFwiLnBvcHVwX3R5cGVfaW1hZ2VcIik7XG5wb3B1cFdpdGhJbWFnZS5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBjYXJkR2FsbGVyeSA9IG5ldyBTZWN0aW9uKFxuICB7IHJlbmRlcmVyOiAoaXRlbSkgPT4gY3JlYXRlQ2FyZCh7IGl0ZW0gfSkgfSxcbiAgXCIuZ2FsbGVyeVwiXG4pO1xuXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XG4gIG5hbWU6IFwiLnVzZXJfX25hbWVcIixcbiAgaW5mbzogXCIudXNlcl9fcHJvZmVzc2lvblwiLFxuICBhdmF0YXI6IFwiLnVzZXJfX2F2YXRhci1pbWFnZVwiLFxufSk7XG5cbi8vYXBpIGNhbGxzXG5cblByb21pc2UuYWxsKFthcGkuZ2V0VXNlckluZm8oKSwgYXBpLmdldEluaXRpYWxDYXJkcygpXSlcbiAgLnRoZW4oKFt1c2VyLCBjYXJkc10pID0+IHtcbiAgICBjdXJyZW50VXNlciA9IHVzZXI7XG4gICAgdXNlckluZm8uc2V0VXNlckluZm8odXNlcik7XG4gICAgdXNlckluZm8uc2V0VXNlckF2YXRhcih1c2VyLmF2YXRhcik7XG4gICAgY2FyZEdhbGxlcnkucmVuZGVySXRlbXMoY2FyZHMpO1xuICB9KVxuICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSk7XG5cbi8vZnVuY3Rpb25zXG5cbmZ1bmN0aW9uIGhhbmRsZUF2YXRhckZvcm1TdWJtaXQodmFsdWVzKSB7XG4gIHBvcHVwV2l0aEVkaXRBdmF0YXJGb3JtLmhhbmRsZUJ1dHRvblRleHQoXCJTYXZpbmcuLi5cIik7XG4gIGFwaVxuICAgIC5lZGl0QXZhdGFyKHZhbHVlcylcbiAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICB1c2VySW5mby5zZXRVc2VyQXZhdGFyKHJlcy5hdmF0YXIpO1xuICAgICAgcG9wdXBXaXRoRWRpdEF2YXRhckZvcm0uY2xvc2UoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHBvcHVwV2l0aEVkaXRBdmF0YXJGb3JtLmhhbmRsZUJ1dHRvblRleHQoXCJTYXZlXCIpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQodmFsdWVzKSB7XG4gIHBvcHVwV2l0aFByb2ZpbGVGb3JtLmhhbmRsZUJ1dHRvblRleHQoXCJTYXZpbmcuLi5cIik7XG4gIGFwaVxuICAgIC5lZGl0UHJvZmlsZSh2YWx1ZXMpXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8ocmVzKTtcbiAgICAgIHBvcHVwV2l0aFByb2ZpbGVGb3JtLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBwb3B1cFdpdGhQcm9maWxlRm9ybS5oYW5kbGVCdXR0b25UZXh0KFwiU2F2ZVwiKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUZvcm1TdWJtaXQoY2FyZCkge1xuICBwb3B1cFdpdGhEZWxldGVGb3JtLmhhbmRsZUJ1dHRvblRleHQoXCJTYXZpbmcuLi5cIik7XG4gIGFwaVxuICAgIC5kZWxldGVDYXJkKGNhcmQpXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgY2FyZC5kZWxldGVDYXJkKCk7XG4gICAgICBwb3B1cFdpdGhEZWxldGVGb3JtLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBwb3B1cFdpdGhEZWxldGVGb3JtLmhhbmRsZUJ1dHRvblRleHQoXCJZZXNcIik7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBoYW5kbGVQbGFjZUZvcm1TdWJtaXQodmFsdWVzKSB7XG4gIHBvcHVwV2l0aEFkZENhcmRGb3JtLmhhbmRsZUJ1dHRvblRleHQoXCJTYXZpbmcuLi5cIik7XG4gIGFwaVxuICAgIC5hZGRDYXJkKHZhbHVlcylcbiAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICBjYXJkR2FsbGVyeS5hZGRJdGVtKHJlcyk7XG4gICAgICBwb3B1cFdpdGhBZGRDYXJkRm9ybS5jbG9zZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgcG9wdXBXaXRoQWRkQ2FyZEZvcm0uaGFuZGxlQnV0dG9uVGV4dChcIlNhdmVcIik7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBjcmVhdGVDYXJkKHsgaXRlbSB9KSB7XG4gIGNvbnN0IGNhcmRJbnN0YW5jZSA9IG5ldyBDYXJkKFxuICAgIHtcbiAgICAgIGRhdGE6IGl0ZW0sXG4gICAgICBoYW5kbGVDYXJkQ2xpY2s6ICh7IG5hbWUsIGxpbmsgfSkgPT4ge1xuICAgICAgICBwb3B1cFdpdGhJbWFnZS5vcGVuKHsgbmFtZSwgbGluayB9KTtcbiAgICAgIH0sXG4gICAgICBoYW5kbGVDYXJkRGVsZXRlOiAoY2FyZEVsZW1lbnQpID0+IHtcbiAgICAgICAgcG9wdXBXaXRoRGVsZXRlRm9ybS5vcGVuRm9yRGVsZXRlKGNhcmRFbGVtZW50KTtcbiAgICAgIH0sXG4gICAgICBoYW5kbGVDYXJkTGlrZTogKGlzTGlrZWQsIGRhdGEpID0+IHtcbiAgICAgICAgaXNMaWtlZFxuICAgICAgICAgID8gYXBpXG4gICAgICAgICAgICAgIC5yZW1vdmVMaWtlKGRhdGEpXG4gICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICBkYXRhLnVwZGF0ZUxpa2VzKHJlcyk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKVxuICAgICAgICAgIDogYXBpXG4gICAgICAgICAgICAgIC5hZGRMaWtlKGRhdGEpXG4gICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICBkYXRhLnVwZGF0ZUxpa2VzKHJlcyk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKTtcbiAgICAgIH0sXG4gICAgfSxcbiAgICBjYXJkVGVtcGxhdGVcbiAgKTtcbiAgY29uc3QgY2FyZCA9IGNhcmRJbnN0YW5jZS5nZW5lcmF0ZUNhcmQoY3VycmVudFVzZXIpO1xuICByZXR1cm4gY2FyZDtcbn1cblxuLy9ldmVudCBsaXN0ZW5lcnNcbmVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgcG9wdXBXaXRoUHJvZmlsZUZvcm0ub3BlbigpO1xuICBjb25zdCB1c2VyRGF0YSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIG5hbWVJbnB1dC52YWx1ZSA9IHVzZXJEYXRhLm5hbWU7XG4gIHByb2ZJbnB1dC52YWx1ZSA9IHVzZXJEYXRhLmFib3V0O1xufSk7XG5hZGRQbGFjZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBwb3B1cFdpdGhBZGRDYXJkRm9ybS5vcGVuKCk7XG4gIHBsYWNlVmFsaWRhdG9yLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XG59KTtcbmVkaXRBdmF0YXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgcG9wdXBXaXRoRWRpdEF2YXRhckZvcm0ub3BlbigpO1xuICBhdmF0YXJWYWxpZGF0b3IudG9nZ2xlQnV0dG9uU3RhdGUoKTtcbn0pO1xuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwRm9yRGVsZXRlIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVTdWJtaXQpIHtcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICB0aGlzLl9oYW5kbGVTdWJtaXQgPSBoYW5kbGVTdWJtaXQ7XG4gICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1cIik7XG4gIH1cbiAgb3BlbkZvckRlbGV0ZShjYXJkSWQpIHtcbiAgICBzdXBlci5vcGVuKCk7XG4gICAgaWYgKGNhcmRJZCkge1xuICAgICAgdGhpcy5fZGF0YSA9IGNhcmRJZDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2RhdGE7XG4gIH1cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLl9wb3B1cC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5faGFuZGxlU3VibWl0KHRoaXMuX2RhdGEpO1xuICAgIH0pO1xuICB9XG59XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cCB7XG4gIG9wZW4oeyBuYW1lLCBsaW5rIH0pIHtcbiAgICBzdXBlci5vcGVuKCk7XG4gICAgdGhpcy5fcGljdHVyZSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2ltYWdlXCIpO1xuICAgIHRoaXMuX3BpY3R1cmUuc3JjID0gbGluaztcbiAgICB0aGlzLl9waWN0dXJlLmFsdCA9IG5hbWUgKyBcIiBwaG90b1wiO1xuICAgIHRoaXMuX3RpdGxlID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1hZ2UtdGl0bGVcIik7XG4gICAgdGhpcy5fdGl0bGUudGV4dENvbnRlbnQgPSBuYW1lO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcbiAgY29uc3RydWN0b3IoeyByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XG4gIH1cbiAgYWRkSXRlbShpdGVtKSB7XG4gICAgY29uc3QgY2FyZCA9IHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGNhcmQpO1xuICB9XG4gIHJlbmRlckl0ZW1zKGRhdGEpIHtcbiAgICBjb25zdCBjYXJkcyA9IEFycmF5LmZyb20oZGF0YSk7XG4gICAgY2FyZHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgdGhpcy5hZGRJdGVtKGl0ZW0pO1xuICAgIH0pO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XG4gIGNvbnN0cnVjdG9yKHsgbmFtZSwgaW5mbywgYXZhdGFyIH0pIHtcbiAgICB0aGlzLl9uYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihuYW1lKTtcbiAgICB0aGlzLl9hYm91dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaW5mbyk7XG4gICAgdGhpcy5fYXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhdmF0YXIpO1xuICB9XG4gIHNldFVzZXJBdmF0YXIoZGF0YSkge1xuICAgIHRoaXMuX2F2YXRhci5zcmMgPSBkYXRhO1xuICB9XG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHRoaXMuX2RhdGEgPSB7XG4gICAgICBuYW1lOiB0aGlzLl9uYW1lLnRleHRDb250ZW50LFxuICAgICAgYWJvdXQ6IHRoaXMuX2Fib3V0LnRleHRDb250ZW50LFxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2RhdGE7XG4gIH1cbiAgc2V0VXNlckluZm8oZGF0YSkge1xuICAgIHRoaXMuX25hbWUudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgdGhpcy5fYWJvdXQudGV4dENvbnRlbnQgPSBkYXRhLmFib3V0O1xuICB9XG59XG4iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwidGVtcGxhdGUiLCJkYXRhIiwiaGFuZGxlQ2FyZENsaWNrIiwiaGFuZGxlQ2FyZERlbGV0ZSIsImhhbmRsZUNhcmRMaWtlIiwidGhpcyIsIl90ZW1wbGF0ZSIsIl9uYW1lIiwibmFtZSIsIl9saW5rIiwibGluayIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfaGFuZGxlQ2FyZExpa2UiLCJfaGFuZGxlQ2FyZERlbGV0ZSIsIl9saWtlcyIsImxpa2VzIiwiX293bmVyIiwib3duZXIiLCJfaWQiLCJfaGFuZGxlRGVsZXRlQnV0dG9uVmlzaWJpbGl0eSIsInVzZXIiLCJfZGVsZXRlQnV0dG9uIiwic3R5bGUiLCJkaXNwbGF5IiwiZGVsZXRlQ2FyZCIsIl9jYXJkRWxlbWVudCIsInJlbW92ZSIsInVwZGF0ZUxpa2VzIiwicmVzIiwiX2xpa2VDb3VudGVyIiwidGV4dENvbnRlbnQiLCJsZW5ndGgiLCJfbGlrZUJ1dHRvbiIsImNsYXNzTGlzdCIsInRvZ2dsZSIsImdldExpa2VzQ291bnQiLCJzb21lIiwiZWwiLCJhZGQiLCJfZ2V0VGVtcGxhdGUiLCJxdWVyeVNlbGVjdG9yIiwiY2xvbmVOb2RlIiwiX2hhbmRsZUxpa2VCdXR0b24iLCJpc0xpa2VkIiwiY29udGFpbnMiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJhZGRFdmVudExpc3RlbmVyIiwiX2NhcmRQaWN0dXJlIiwiZ2VuZXJhdGVDYXJkIiwiX2NhcmQiLCJzcmMiLCJhbHQiLCJGb3JtVmFsaWRhdG9yIiwiZm9ybSIsInNldHRpbmdzIiwiX3NldHRpbmdzIiwiX2Zvcm0iLCJfc2hvd0lucHV0RXJyb3IiLCJpbnB1dCIsIl9lcnJvciIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl9oaWRlSW5wdXRFcnJvciIsIl9oYXNJbnZhbGlkSW5wdXQiLCJpbnB1dHMiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiX2lucHV0cyIsIl9idXR0b24iLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiZGlzYWJsZWQiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpbnB1dFNlbGVjdG9yIiwiZm9yRWFjaCIsImVuYWJsZVZhbGlkYXRpb24iLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsImtleSIsImNsb3NlIiwiX3BvcHVwIiwiZG9jdW1lbnQiLCJoYW5kbGVCdXR0b25UZXh0IiwidGV4dCIsIm9wZW4iLCJfaGFuZGxlRXNjQ2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJ0YXJnZXQiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlU3VibWl0Iiwic3VwZXIiLCJfaGFuZGxlU3VibWl0IiwiX2RhdGEiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJ2YWx1ZSIsInJlc2V0IiwiZm9ybVNlbGVjdG9yIiwiZWRpdEJ1dHRvbiIsIm5hbWVJbnB1dCIsInByb2ZJbnB1dCIsImZvcm1Vc2VyRWxlbWVudCIsImZvcm1QbGFjZUVsZW1lbnQiLCJmb3JtQXZhdGFyRWxlbWVudCIsImFkZFBsYWNlQnV0dG9uIiwiZWRpdEF2YXRhckJ1dHRvbiIsImNhcmRUZW1wbGF0ZSIsImNvbnRlbnQiLCJjdXJyZW50VXNlciIsInZhbGlkYXRlU2VsZWN0b3JzIiwicGxhY2VWYWxpZGF0b3IiLCJhdmF0YXJWYWxpZGF0b3IiLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJhZGRMaWtlIiwiY2FyZCIsImZldGNoIiwibWV0aG9kIiwidGhlbiIsIl9jaGVja1Jlc3BvbnNlIiwicmVtb3ZlTGlrZSIsImVkaXRBdmF0YXIiLCJ2YWx1ZXMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImF2YXRhciIsImVkaXRQcm9maWxlIiwiYWJvdXQiLCJwcm9mZXNzaW9uIiwiYWRkQ2FyZCIsInBsYWNlIiwidXJsIiwiZ2V0VXNlckluZm8iLCJnZXRJbml0aWFsQ2FyZHMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiYXV0aG9yaXphdGlvbiIsInBvcHVwV2l0aFByb2ZpbGVGb3JtIiwidXNlckluZm8iLCJzZXRVc2VySW5mbyIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImZpbmFsbHkiLCJwb3B1cFdpdGhEZWxldGVGb3JtIiwib3BlbkZvckRlbGV0ZSIsImNhcmRJZCIsInBvcHVwV2l0aEFkZENhcmRGb3JtIiwiY2FyZEdhbGxlcnkiLCJhZGRJdGVtIiwicG9wdXBXaXRoRWRpdEF2YXRhckZvcm0iLCJzZXRVc2VyQXZhdGFyIiwicG9wdXBXaXRoSW1hZ2UiLCJfcGljdHVyZSIsIl90aXRsZSIsImNvbnRhaW5lclNlbGVjdG9yIiwicmVuZGVyZXIiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwiaXRlbSIsInByZXBlbmQiLCJyZW5kZXJJdGVtcyIsImNhcmRFbGVtZW50IiwiY3JlYXRlQ2FyZCIsImluZm8iLCJfYWJvdXQiLCJfYXZhdGFyIiwiYWxsIiwiY2FyZHMiLCJ1c2VyRGF0YSJdLCJzb3VyY2VSb290IjoiIn0=