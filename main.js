!function(){"use strict";class e{constructor(e,t){let{data:s,handleCardClick:n,handleCardDelete:r,handleCardLike:i}=e;this._template=t,this._name=s.name,this._link=s.link,this._handleCardClick=n,this._handleCardLike=i,this._handleCardDelete=r,this._likes=s.likes,this._owner=s.owner._id,this._id=s._id}_handleDeleteButtonVisibility(e){this._owner!==e._id&&(this._deleteButton.style.display="none")}deleteCard(){this._cardElement.remove()}updateLikes(e){this._likeCounter.textContent=e.likes.length,this._likeButton.classList.toggle("card__like-button_active")}getLikesCount(e){this._likes.some((t=>t._id===e._id))&&this._likeButton.classList.add("card__like-button_active"),this._likeCounter.textContent=this._likes.length<1?"":this._likes.length}_getTemplate(){return this._cardElement=this._template.querySelector(".card").cloneNode(!0),this._cardElement}_handleLikeButton(){const e=this._likeButton.classList.contains("card__like-button_active");this._handleCardLike(e,this)}_setEventListeners(){this._likeButton.addEventListener("click",(()=>{this._handleLikeButton()})),this._deleteButton.addEventListener("click",(()=>{this._handleCardDelete(this)})),this._cardPicture.addEventListener("click",(()=>this._handleCardClick({name:this._name,link:this._link})))}generateCard(e){return this._card=this._getTemplate(),this._cardPicture=this._card.querySelector(".card__image"),this._cardPicture.src=this._link,this._deleteButton=this._card.querySelector(".card__delete-button"),this._likeCounter=this._card.querySelector(".card__like-counter"),this._likeButton=this._card.querySelector(".card__like-button"),this.getLikesCount(e),this._handleDeleteButtonVisibility(e),this._cardPicture.alt=this._name+" photo",this._card.querySelector(".card__description").textContent=this._name,this._setEventListeners(e),this._card}}class t{constructor(e,t){this._settings=t,this._form=e}_showInputError(e){this._error=this._form.querySelector(".".concat(e.name,"-input-error")),e.classList.add(this._settings.inputErrorClass),this._error.classList.add(this._settings.errorClass),this._error.textContent=e.validationMessage}_hideInputError(e){this._error=this._form.querySelector(".".concat(e.name,"-input-error")),e.classList.remove(this._settings.inputErrorClass),this._error.classList.remove(this._settings.errorClass),this._error.textContent=""}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}toggleButtonState(){this._hasInvalidInput(this._inputs)?(this._button.classList.add(this._settings.inactiveButtonClass),this._button.disabled=!0):(this._button.classList.remove(this._settings.inactiveButtonClass),this._button.disabled=!1)}_setEventListeners(){this._button=this._form.querySelector(this._settings.submitButtonSelector),this._inputs=Array.from(this._form.querySelectorAll(this._settings.inputSelector)),this.toggleButtonState(),this._inputs.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this.toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}class s{constructor(e){var t,s;s=e=>{"Escape"===e.key&&this.close()},(t="_handleEscClose")in this?Object.defineProperty(this,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[t]=s,this._popup=document.querySelector(e)}handleButtonText(e){this._popup.querySelector(".popup__button").textContent=e}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popup.addEventListener("click",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class n extends s{constructor(e,t){super(e),this._handleSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._data={},this._inputs=this._popup.querySelectorAll(".popup__form-input")}_getInputValues(){return this._inputs.forEach((e=>{this._data[e.name]=e.value})),this._data}close(){super.close(),this._form.reset()}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(e=>{this._data=this._getInputValues(),e.preventDefault(),this._handleSubmit(this._data)}))}}const r={formSelector:".popup__form",inputSelector:".popup__form-input",submitButtonSelector:".popup__form-button",inactiveButtonClass:"popup__form-button_disabled",inputErrorClass:"popup__form-input_type_error",errorClass:"popup__error_active"},i=document.querySelector(".user__edit-button"),a=document.querySelector(".popup__form-input_type_name"),o=document.querySelector(".popup__form-input_type_profession"),l=document.querySelector(".popup__form_type_profile"),h=document.querySelector(".popup__form_type_place"),c=document.querySelector(".popup__form_type_avatar"),_=document.querySelector(".user__add-button"),d=document.querySelector(".user__avatar-overlay"),u=document.querySelector("#template").content;let p={};new t(l,r).enableValidation();const m=new t(h,r);m.enableValidation();const v=new t(c,r);v.enableValidation();const f=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}addLike(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e._id),{method:"PUT",headers:this._headers}).then((e=>this._checkResponse(e)))}removeLike(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e._id),{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e)))}editAvatar(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatar})}).then((e=>this._checkResponse(e)))}editProfile(e){return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.profession})}).then((e=>this._checkResponse(e)))}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e._id),{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e)))}addCard(e){return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.place,link:e.url})}).then((e=>this._checkResponse(e)))}getUserInfo(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>this._checkResponse(e)))}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((e=>this._checkResponse(e)))}_checkResponse(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"545ebbe5-83ef-479f-9e3a-79ad4591aa10","Content-Type":"application/json"}}),k=new n(".popup_type_profile",(function(e){k.handleButtonText("Saving..."),f.editProfile(e).then((e=>{S.setUserInfo(e)})).catch((e=>console.log(e))).finally((()=>{k.close(),k.handleButtonText("Save")}))}));k.setEventListeners();const y=new class extends s{constructor(e,t){super(e),this._handleSubmit=t,this._form=this._popup.querySelector(".popup__form")}openForDelete(e){return super.open(),e&&(this._data=e),this._data}setEventListeners(){this._popup.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit(this._data)}))}}(".popup_type_delete",(function(e){y.handleButtonText("Saving..."),f.deleteCard(e).then((t=>{e.deleteCard()})).catch((e=>console.log(e))).finally((()=>{y.close(),y.handleButtonText("Yes")}))}));y.setEventListeners();const g=new n(".popup_type_place",(function(e){g.handleButtonText("Saving..."),f.addCard(e).then((e=>{L.addItem(e)})).catch((e=>console.log(e))).finally((()=>{g.close(),g.handleButtonText("Save")}))}));g.setEventListeners();const b=new n(".popup_type_avatar",(function(e){b.handleButtonText("Saving..."),f.editAvatar(e).then((e=>{S.setUserAvatar(e.avatar)})).catch((e=>console.log(e))).finally((()=>{b.close(),b.handleButtonText("Save")}))}));b.setEventListeners();const C=new class extends s{open(e){let{name:t,link:s}=e;super.open(),this._picture=this._popup.querySelector(".popup__image"),this._picture.src=s,this._picture.alt=t+" photo",this._title=this._popup.querySelector(".popup__image-title"),this._title.textContent=t}}(".popup_type_image");C.setEventListeners();const L=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}addItem(e){const t=this._renderer(e);this._container.prepend(t)}renderItems(e){Array.from(e).forEach((e=>{this.addItem(e)}))}}({renderer:t=>function(t){let{item:s}=t;return new e({data:s,handleCardClick:e=>{let{name:t,link:s}=e;C.open({name:t,link:s})},handleCardDelete:e=>{y.openForDelete(e)},handleCardLike:(e,t)=>{e?f.removeLike(t).then((e=>{t.updateLikes(e)})).catch((e=>console.log(e))):f.addLike(t).then((e=>{t.updateLikes(e)})).catch((e=>console.log(e)))}},u).generateCard(p)}({item:t})},".gallery"),S=new class{constructor(e){let{name:t,info:s,avatar:n}=e;this._name=document.querySelector(t),this._about=document.querySelector(s),this._avatar=document.querySelector(n)}setUserAvatar(e){this._avatar.src=e}getUserInfo(){return this._data={name:this._name.textContent,about:this._about.textContent},this._data}setUserInfo(e){this._name.textContent=e.name,this._about.textContent=e.about}}({name:".user__name",info:".user__profession",avatar:".user__avatar-image"});Promise.all([f.getUserInfo(),f.getInitialCards()]).then((e=>{let[t,s]=e;p=t,S.setUserInfo(t),S.setUserAvatar(t.avatar),L.renderItems(s)})).catch((e=>console.log(e))),i.addEventListener("click",(()=>{k.open();const e=S.getUserInfo();a.value=e.name,o.value=e.about})),_.addEventListener("click",(()=>{g.open(),m.toggleButtonState()})),d.addEventListener("click",(()=>{b.open(),v.toggleButtonState()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUl3QixjQUFleEIsRUFBSXlCLG9CQUNqQ2hCLE1BQUssSUFBbUIsSUFBakI1RyxFQUFNbUssR0FBVyxFQUN2Qm5FLEVBQWNoRyxFQUNkb0ksRUFBU0MsWUFBWXJJLEdBQ3JCb0ksRUFBU2MsY0FBY2xKLEVBQUtvSCxRQUM1QjJCLEVBQVlhLFlBQVlPLE1BRXpCN0IsT0FBT0MsR0FBUUMsUUFBUUMsSUFBSUYsS0F5RjlCakQsRUFBVzVELGlCQUFpQixTQUFTLEtBQ25DeUcsRUFBcUI1RCxPQUNyQixNQUFNNkYsRUFBV2hDLEVBQVNULGNBQzFCcEMsRUFBVUwsTUFBUWtGLEVBQVNoTCxLQUMzQm9HLEVBQVVOLE1BQVFrRixFQUFTOUMsU0FFN0IxQixFQUFlbEUsaUJBQWlCLFNBQVMsS0FDdkNvSCxFQUFxQnZFLE9BQ3JCMEIsRUFBZWhELHVCQUVqQjRDLEVBQWlCbkUsaUJBQWlCLFNBQVMsS0FDekN1SCxFQUF3QjFFLE9BQ3hCMkIsRUFBZ0JqRCx1QiIsInNvdXJjZXMiOlsid2VicGFjazovL2Fyb3VuZHVzLy4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly9hcm91bmR1cy8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vYXJvdW5kdXMvLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly9hcm91bmR1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vYXJvdW5kdXMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vYXJvdW5kdXMvLi9zcmMvY29tcG9uZW50cy9BcGkuanMiLCJ3ZWJwYWNrOi8vYXJvdW5kdXMvLi9zcmMvY29tcG9uZW50cy9Qb3B1cEZvckRlbGV0ZS5qcyIsIndlYnBhY2s6Ly9hcm91bmR1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL2Fyb3VuZHVzLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly9hcm91bmR1cy8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xuICBjb25zdHJ1Y3RvcihcbiAgICB7IGRhdGEsIGhhbmRsZUNhcmRDbGljaywgaGFuZGxlQ2FyZERlbGV0ZSwgaGFuZGxlQ2FyZExpa2UgfSxcbiAgICB0ZW1wbGF0ZVxuICApIHtcbiAgICB0aGlzLl90ZW1wbGF0ZSA9IHRlbXBsYXRlO1xuICAgIHRoaXMuX25hbWUgPSBkYXRhLm5hbWU7XG4gICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcbiAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgPSBoYW5kbGVDYXJkQ2xpY2s7XG4gICAgdGhpcy5faGFuZGxlQ2FyZExpa2UgPSBoYW5kbGVDYXJkTGlrZTtcbiAgICB0aGlzLl9oYW5kbGVDYXJkRGVsZXRlID0gaGFuZGxlQ2FyZERlbGV0ZTtcbiAgICB0aGlzLl9saWtlcyA9IGRhdGEubGlrZXM7XG4gICAgdGhpcy5fb3duZXIgPSBkYXRhLm93bmVyLl9pZDtcbiAgICB0aGlzLl9pZCA9IGRhdGEuX2lkO1xuICB9XG4gIF9oYW5kbGVEZWxldGVCdXR0b25WaXNpYmlsaXR5KHVzZXIpIHtcbiAgICBpZiAodGhpcy5fb3duZXIgIT09IHVzZXIuX2lkKSB7XG4gICAgICB0aGlzLl9kZWxldGVCdXR0b24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIH1cbiAgfVxuICBkZWxldGVDYXJkKCkge1xuICAgIHRoaXMuX2NhcmRFbGVtZW50LnJlbW92ZSgpO1xuICB9XG4gIHVwZGF0ZUxpa2VzKHJlcykge1xuICAgIHRoaXMuX2xpa2VDb3VudGVyLnRleHRDb250ZW50ID0gcmVzLmxpa2VzLmxlbmd0aDtcbiAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gIH1cbiAgZ2V0TGlrZXNDb3VudCh1c2VyKSB7XG4gICAgdGhpcy5fbGlrZXMuc29tZSgoZWwpID0+IGVsLl9pZCA9PT0gdXNlci5faWQpICYmXG4gICAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gICAgdGhpcy5fbGlrZUNvdW50ZXIudGV4dENvbnRlbnQgPVxuICAgICAgdGhpcy5fbGlrZXMubGVuZ3RoIDwgMSA/IFwiXCIgOiB0aGlzLl9saWtlcy5sZW5ndGg7XG4gIH1cbiAgX2dldFRlbXBsYXRlKCkge1xuICAgIHRoaXMuX2NhcmRFbGVtZW50ID0gdGhpcy5fdGVtcGxhdGUucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpLmNsb25lTm9kZSh0cnVlKTtcbiAgICByZXR1cm4gdGhpcy5fY2FyZEVsZW1lbnQ7XG4gIH1cbiAgX2hhbmRsZUxpa2VCdXR0b24oKSB7XG4gICAgY29uc3QgaXNMaWtlZCA9IHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKFxuICAgICAgXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIlxuICAgICk7XG4gICAgdGhpcy5faGFuZGxlQ2FyZExpa2UoaXNMaWtlZCwgdGhpcyk7XG4gIH1cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2xpa2VCdXR0b25cbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLl9oYW5kbGVMaWtlQnV0dG9uKCk7XG4gICAgICB9KTtcbiAgICB0aGlzLl9kZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZUNhcmREZWxldGUodGhpcyk7XG4gICAgfSk7XG4gICAgdGhpcy5fY2FyZFBpY3R1cmUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XG4gICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2soe1xuICAgICAgICBuYW1lOiB0aGlzLl9uYW1lLFxuICAgICAgICBsaW5rOiB0aGlzLl9saW5rLFxuICAgICAgfSlcbiAgICApO1xuICB9XG4gIGdlbmVyYXRlQ2FyZCh1c2VyKSB7XG4gICAgdGhpcy5fY2FyZCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XG4gICAgdGhpcy5fY2FyZFBpY3R1cmUgPSB0aGlzLl9jYXJkLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gICAgdGhpcy5fY2FyZFBpY3R1cmUuc3JjID0gdGhpcy5fbGluaztcbiAgICB0aGlzLl9kZWxldGVCdXR0b24gPSB0aGlzLl9jYXJkLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKTtcbiAgICB0aGlzLl9saWtlQ291bnRlciA9IHRoaXMuX2NhcmQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWNvdW50ZXJcIik7XG4gICAgdGhpcy5fbGlrZUJ1dHRvbiA9IHRoaXMuX2NhcmQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKTtcbiAgICB0aGlzLmdldExpa2VzQ291bnQodXNlcik7XG4gICAgdGhpcy5faGFuZGxlRGVsZXRlQnV0dG9uVmlzaWJpbGl0eSh1c2VyKTtcbiAgICB0aGlzLl9jYXJkUGljdHVyZS5hbHQgPSB0aGlzLl9uYW1lICsgXCIgcGhvdG9cIjtcbiAgICB0aGlzLl9jYXJkLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVzY3JpcHRpb25cIikudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKHVzZXIpO1xuICAgIHJldHVybiB0aGlzLl9jYXJkO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3IoZm9ybSwgc2V0dGluZ3MpIHtcbiAgICB0aGlzLl9zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgIHRoaXMuX2Zvcm0gPSBmb3JtO1xuICB9XG4gIF9zaG93SW5wdXRFcnJvcihpbnB1dCkge1xuICAgIHRoaXMuX2Vycm9yID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dC5uYW1lfS1pbnB1dC1lcnJvcmApO1xuICAgIGlucHV0LmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcbiAgICB0aGlzLl9lcnJvci5jbGFzc0xpc3QuYWRkKHRoaXMuX3NldHRpbmdzLmVycm9yQ2xhc3MpO1xuICAgIHRoaXMuX2Vycm9yLnRleHRDb250ZW50ID0gaW5wdXQudmFsaWRhdGlvbk1lc3NhZ2U7XG4gIH1cbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0KSB7XG4gICAgdGhpcy5fZXJyb3IgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0Lm5hbWV9LWlucHV0LWVycm9yYCk7XG4gICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xuICAgIHRoaXMuX2Vycm9yLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuZXJyb3JDbGFzcyk7XG4gICAgdGhpcy5fZXJyb3IudGV4dENvbnRlbnQgPSBcIlwiO1xuICB9XG4gIF9oYXNJbnZhbGlkSW5wdXQoaW5wdXRzKSB7XG4gICAgcmV0dXJuIGlucHV0cy5zb21lKChpbnB1dCkgPT4ge1xuICAgICAgcmV0dXJuICFpbnB1dC52YWxpZGl0eS52YWxpZDtcbiAgICB9KTtcbiAgfVxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0KSB7XG4gICAgaWYgKGlucHV0LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0KTtcbiAgICB9XG4gIH1cbiAgdG9nZ2xlQnV0dG9uU3RhdGUoKSB7XG4gICAgaWYgKHRoaXMuX2hhc0ludmFsaWRJbnB1dCh0aGlzLl9pbnB1dHMpKSB7XG4gICAgICB0aGlzLl9idXR0b24uY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgIHRoaXMuX2J1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2J1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgdGhpcy5fYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgfVxuICB9XG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9idXR0b24gPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICB0aGlzLl9zZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvclxuICAgICk7XG4gICAgdGhpcy5faW5wdXRzID0gQXJyYXkuZnJvbShcbiAgICAgIHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9zZXR0aW5ncy5pbnB1dFNlbGVjdG9yKVxuICAgICk7XG4gICAgdGhpcy50b2dnbGVCdXR0b25TdGF0ZSgpO1xuICAgIHRoaXMuX2lucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0KTtcbiAgICAgICAgdGhpcy50b2dnbGVCdXR0b25TdGF0ZSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbiAgZW5hYmxlVmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgdGhpcy5fcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xuICB9XG4gIGhhbmRsZUJ1dHRvblRleHQodGV4dCkge1xuICAgIGNvbnN0IGJ1dHRvbiA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fYnV0dG9uJyk7XG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gdGV4dDtcbiAgfVxuICBvcGVuKCkge1xuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuZWRcIik7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICB9XG4gIGNsb3NlKCkge1xuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9vcGVuZWRcIik7XG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICB9XG4gIF9oYW5kbGVFc2NDbG9zZSA9IChldnQpID0+IHtcbiAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfTtcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9vcGVuZWRcIikgfHxcbiAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9fY2xvc2UtYnV0dG9uXCIpXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaGFuZGxlU3VibWl0KSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5faGFuZGxlU3VibWl0ID0gaGFuZGxlU3VibWl0O1xuICAgIHRoaXMuX2Zvcm0gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xuICAgIHRoaXMuX2RhdGEgPSB7fTtcbiAgICB0aGlzLl9pbnB1dHMgPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19mb3JtLWlucHV0XCIpO1xuICB9XG4gIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICB0aGlzLl9pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIHRoaXMuX2RhdGFbaW5wdXQubmFtZV0gPSBpbnB1dC52YWx1ZTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcy5fZGF0YTtcbiAgfVxuICBjbG9zZSgpIHtcbiAgICBzdXBlci5jbG9zZSgpO1xuICAgIHRoaXMuX2Zvcm0ucmVzZXQoKTtcbiAgfVxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX3BvcHVwLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICAgICAgdGhpcy5fZGF0YSA9IHRoaXMuX2dldElucHV0VmFsdWVzKCk7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCh0aGlzLl9kYXRhKTtcbiAgICB9KTtcbiAgfVxufVxuIiwiLy9pbXBvcnRzXG5cbmltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xuaW1wb3J0IFBvcHVwRm9yRGVsZXRlIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwRm9yRGVsZXRlLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xuXG4vL3NldHRpbmdzXG5cbmNvbnN0IHZhbGlkYXRlU2VsZWN0b3JzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLnBvcHVwX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19mb3JtLWlucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybS1idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fZm9ybS1idXR0b25fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19mb3JtLWlucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJwb3B1cF9fZXJyb3JfYWN0aXZlXCIsXG59O1xuXG4vL3ZhcmlhYmxlc1xuXG5jb25zdCBlZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi51c2VyX19lZGl0LWJ1dHRvblwiKTtcbmNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm0taW5wdXRfdHlwZV9uYW1lXCIpO1xuY29uc3QgcHJvZklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybS1pbnB1dF90eXBlX3Byb2Zlc3Npb25cIik7XG5jb25zdCBmb3JtVXNlckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtX3R5cGVfcHJvZmlsZVwiKTtcbmNvbnN0IGZvcm1QbGFjZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtX3R5cGVfcGxhY2VcIik7XG5jb25zdCBmb3JtQXZhdGFyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1fdHlwZV9hdmF0YXJcIik7XG5jb25zdCBhZGRQbGFjZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudXNlcl9fYWRkLWJ1dHRvblwiKTtcbmNvbnN0IGVkaXRBdmF0YXJCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnVzZXJfX2F2YXRhci1vdmVybGF5XCIpO1xuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN0ZW1wbGF0ZVwiKS5jb250ZW50O1xubGV0IGN1cnJlbnRVc2VyID0ge307XG5cbi8vdmFsaWRhdG9yc1xuXG5jb25zdCBwcm9maWxlVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybVVzZXJFbGVtZW50LCB2YWxpZGF0ZVNlbGVjdG9ycyk7XG5wcm9maWxlVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuY29uc3QgcGxhY2VWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihmb3JtUGxhY2VFbGVtZW50LCB2YWxpZGF0ZVNlbGVjdG9ycyk7XG5wbGFjZVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbmNvbnN0IGF2YXRhclZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1BdmF0YXJFbGVtZW50LCB2YWxpZGF0ZVNlbGVjdG9ycyk7XG5hdmF0YXJWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG4vL2NsYXNzIGluc3RhbmNlc1xuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9jb2hvcnQtMy1lblwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCI1NDVlYmJlNS04M2VmLTQ3OWYtOWUzYS03OWFkNDU5MWFhMTBcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG5jb25zdCBwb3B1cFdpdGhQcm9maWxlRm9ybSA9IG5ldyBQb3B1cFdpdGhGb3JtKFxuICBcIi5wb3B1cF90eXBlX3Byb2ZpbGVcIixcbiAgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXRcbik7XG5wb3B1cFdpdGhQcm9maWxlRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBwb3B1cFdpdGhEZWxldGVGb3JtID0gbmV3IFBvcHVwRm9yRGVsZXRlKFxuICBcIi5wb3B1cF90eXBlX2RlbGV0ZVwiLFxuICBoYW5kbGVEZWxldGVGb3JtU3VibWl0XG4pO1xucG9wdXBXaXRoRGVsZXRlRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBwb3B1cFdpdGhBZGRDYXJkRm9ybSA9IG5ldyBQb3B1cFdpdGhGb3JtKFxuICBcIi5wb3B1cF90eXBlX3BsYWNlXCIsXG4gIGhhbmRsZVBsYWNlRm9ybVN1Ym1pdFxuKTtcbnBvcHVwV2l0aEFkZENhcmRGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IHBvcHVwV2l0aEVkaXRBdmF0YXJGb3JtID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gIFwiLnBvcHVwX3R5cGVfYXZhdGFyXCIsXG4gIGhhbmRsZUF2YXRhckZvcm1TdWJtaXRcbik7XG5wb3B1cFdpdGhFZGl0QXZhdGFyRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBwb3B1cFdpdGhJbWFnZSA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIi5wb3B1cF90eXBlX2ltYWdlXCIpO1xucG9wdXBXaXRoSW1hZ2Uuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3QgY2FyZEdhbGxlcnkgPSBuZXcgU2VjdGlvbihcbiAgeyByZW5kZXJlcjogKGl0ZW0pID0+IGNyZWF0ZUNhcmQoeyBpdGVtIH0pIH0sXG4gIFwiLmdhbGxlcnlcIlxuKTtcblxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xuICBuYW1lOiBcIi51c2VyX19uYW1lXCIsXG4gIGluZm86IFwiLnVzZXJfX3Byb2Zlc3Npb25cIixcbiAgYXZhdGFyOiBcIi51c2VyX19hdmF0YXItaW1hZ2VcIixcbn0pO1xuXG4vL2FwaSBjYWxsc1xuXG5Qcm9taXNlLmFsbChbYXBpLmdldFVzZXJJbmZvKCksIGFwaS5nZXRJbml0aWFsQ2FyZHMoKV0pXG4gIC50aGVuKChbdXNlciwgY2FyZHNdKSA9PiB7XG4gICAgY3VycmVudFVzZXIgPSB1c2VyO1xuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHVzZXIpO1xuICAgIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIodXNlci5hdmF0YXIpO1xuICAgIGNhcmRHYWxsZXJ5LnJlbmRlckl0ZW1zKGNhcmRzKTtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpO1xuXG4vL2Z1bmN0aW9uc1xuXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJGb3JtU3VibWl0KHZhbHVlcykge1xuICBwb3B1cFdpdGhFZGl0QXZhdGFyRm9ybS5oYW5kbGVCdXR0b25UZXh0KFwiU2F2aW5nLi4uXCIpO1xuICBhcGlcbiAgICAuZWRpdEF2YXRhcih2YWx1ZXMpXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgdXNlckluZm8uc2V0VXNlckF2YXRhcihyZXMuYXZhdGFyKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHBvcHVwV2l0aEVkaXRBdmF0YXJGb3JtLmNsb3NlKCk7XG4gICAgICBwb3B1cFdpdGhFZGl0QXZhdGFyRm9ybS5oYW5kbGVCdXR0b25UZXh0KFwiU2F2ZVwiKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KHZhbHVlcykge1xuICBwb3B1cFdpdGhQcm9maWxlRm9ybS5oYW5kbGVCdXR0b25UZXh0KFwiU2F2aW5nLi4uXCIpO1xuICBhcGlcbiAgICAuZWRpdFByb2ZpbGUodmFsdWVzKVxuICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHJlcyk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBwb3B1cFdpdGhQcm9maWxlRm9ybS5jbG9zZSgpO1xuICAgICAgcG9wdXBXaXRoUHJvZmlsZUZvcm0uaGFuZGxlQnV0dG9uVGV4dChcIlNhdmVcIik7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBoYW5kbGVEZWxldGVGb3JtU3VibWl0KGNhcmQpIHtcbiAgcG9wdXBXaXRoRGVsZXRlRm9ybS5oYW5kbGVCdXR0b25UZXh0KFwiU2F2aW5nLi4uXCIpO1xuICBhcGlcbiAgICAuZGVsZXRlQ2FyZChjYXJkKVxuICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgIGNhcmQuZGVsZXRlQ2FyZCgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgcG9wdXBXaXRoRGVsZXRlRm9ybS5jbG9zZSgpO1xuICAgICAgcG9wdXBXaXRoRGVsZXRlRm9ybS5oYW5kbGVCdXR0b25UZXh0KFwiWWVzXCIpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gaGFuZGxlUGxhY2VGb3JtU3VibWl0KHZhbHVlcykge1xuICBwb3B1cFdpdGhBZGRDYXJkRm9ybS5oYW5kbGVCdXR0b25UZXh0KFwiU2F2aW5nLi4uXCIpO1xuICBhcGlcbiAgICAuYWRkQ2FyZCh2YWx1ZXMpXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgY2FyZEdhbGxlcnkuYWRkSXRlbShyZXMpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgcG9wdXBXaXRoQWRkQ2FyZEZvcm0uY2xvc2UoKTtcbiAgICAgIHBvcHVwV2l0aEFkZENhcmRGb3JtLmhhbmRsZUJ1dHRvblRleHQoXCJTYXZlXCIpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gY3JlYXRlQ2FyZCh7IGl0ZW0gfSkge1xuICBjb25zdCBjYXJkSW5zdGFuY2UgPSBuZXcgQ2FyZChcbiAgICB7XG4gICAgICBkYXRhOiBpdGVtLFxuICAgICAgaGFuZGxlQ2FyZENsaWNrOiAoeyBuYW1lLCBsaW5rIH0pID0+IHtcbiAgICAgICAgcG9wdXBXaXRoSW1hZ2Uub3Blbih7IG5hbWUsIGxpbmsgfSk7XG4gICAgICB9LFxuICAgICAgaGFuZGxlQ2FyZERlbGV0ZTogKGNhcmRFbGVtZW50KSA9PiB7XG4gICAgICAgIHBvcHVwV2l0aERlbGV0ZUZvcm0ub3BlbkZvckRlbGV0ZShjYXJkRWxlbWVudCk7XG4gICAgICB9LFxuICAgICAgaGFuZGxlQ2FyZExpa2U6IChpc0xpa2VkLCBkYXRhKSA9PiB7XG4gICAgICAgIGlzTGlrZWRcbiAgICAgICAgICA/IGFwaVxuICAgICAgICAgICAgICAucmVtb3ZlTGlrZShkYXRhKVxuICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgZGF0YS51cGRhdGVMaWtlcyhyZXMpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcbiAgICAgICAgICA6IGFwaVxuICAgICAgICAgICAgICAuYWRkTGlrZShkYXRhKVxuICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgZGF0YS51cGRhdGVMaWtlcyhyZXMpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSk7XG4gICAgICB9LFxuICAgIH0sXG4gICAgY2FyZFRlbXBsYXRlXG4gICk7XG4gIGNvbnN0IGNhcmQgPSBjYXJkSW5zdGFuY2UuZ2VuZXJhdGVDYXJkKGN1cnJlbnRVc2VyKTtcbiAgcmV0dXJuIGNhcmQ7XG59XG5cbi8vZXZlbnQgbGlzdGVuZXJzXG5lZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHBvcHVwV2l0aFByb2ZpbGVGb3JtLm9wZW4oKTtcbiAgY29uc3QgdXNlckRhdGEgPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xuICBuYW1lSW5wdXQudmFsdWUgPSB1c2VyRGF0YS5uYW1lO1xuICBwcm9mSW5wdXQudmFsdWUgPSB1c2VyRGF0YS5hYm91dDtcbn0pO1xuYWRkUGxhY2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgcG9wdXBXaXRoQWRkQ2FyZEZvcm0ub3BlbigpO1xuICBwbGFjZVZhbGlkYXRvci50b2dnbGVCdXR0b25TdGF0ZSgpO1xufSk7XG5lZGl0QXZhdGFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHBvcHVwV2l0aEVkaXRBdmF0YXJGb3JtLm9wZW4oKTtcbiAgYXZhdGFyVmFsaWRhdG9yLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XG59KTtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cbiAgYWRkTGlrZShjYXJkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZC5faWR9YCwge1xuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKSk7XG4gIH1cbiAgcmVtb3ZlTGlrZShjYXJkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZC5faWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKSk7XG4gIH1cbiAgZWRpdEF2YXRhcih2YWx1ZXMpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXI6IHZhbHVlcy5hdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKSk7XG4gIH1cbiAgZWRpdFByb2ZpbGUodmFsdWVzKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lOiB2YWx1ZXMubmFtZSxcbiAgICAgICAgYWJvdXQ6IHZhbHVlcy5wcm9mZXNzaW9uLFxuICAgICAgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcykpO1xuICB9XG4gIGRlbGV0ZUNhcmQoY2FyZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmQuX2lkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcykpO1xuICB9XG4gIGFkZENhcmQodmFsdWVzKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWU6IHZhbHVlcy5wbGFjZSxcbiAgICAgICAgbGluazogdmFsdWVzLnVybCxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpKTtcbiAgfVxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpKTtcbiAgfVxuXG4gIGdldEluaXRpYWxDYXJkcygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpKTtcbiAgfVxuXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIH1cbn1cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cFwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cEZvckRlbGV0ZSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaGFuZGxlU3VibWl0KSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5faGFuZGxlU3VibWl0ID0gaGFuZGxlU3VibWl0O1xuICAgIHRoaXMuX2Zvcm0gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xuICB9XG4gIG9wZW5Gb3JEZWxldGUoY2FyZElkKSB7XG4gICAgc3VwZXIub3BlbigpO1xuICAgIGlmIChjYXJkSWQpIHtcbiAgICAgIHRoaXMuX2RhdGEgPSBjYXJkSWQ7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9kYXRhO1xuICB9XG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX3BvcHVwLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLl9oYW5kbGVTdWJtaXQodGhpcy5fZGF0YSk7XG4gICAgfSk7XG4gIH1cbn1cbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcbiAgb3Blbih7IG5hbWUsIGxpbmsgfSkge1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgICB0aGlzLl9waWN0dXJlID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1hZ2VcIik7XG4gICAgdGhpcy5fcGljdHVyZS5zcmMgPSBsaW5rO1xuICAgIHRoaXMuX3BpY3R1cmUuYWx0ID0gbmFtZSArIFwiIHBob3RvXCI7XG4gICAgdGhpcy5fdGl0bGUgPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWFnZS10aXRsZVwiKTtcbiAgICB0aGlzLl90aXRsZS50ZXh0Q29udGVudCA9IG5hbWU7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xuICBjb25zdHJ1Y3Rvcih7IHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgfVxuICBhZGRJdGVtKGl0ZW0pIHtcbiAgICBjb25zdCBjYXJkID0gdGhpcy5fcmVuZGVyZXIoaXRlbSk7XG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoY2FyZCk7XG4gIH1cbiAgcmVuZGVySXRlbXMoZGF0YSkge1xuICAgIGNvbnN0IGNhcmRzID0gQXJyYXkuZnJvbShkYXRhKTtcbiAgICBjYXJkcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICB0aGlzLmFkZEl0ZW0oaXRlbSk7XG4gICAgfSk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcbiAgY29uc3RydWN0b3IoeyBuYW1lLCBpbmZvLCBhdmF0YXIgfSkge1xuICAgIHRoaXMuX25hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWUpO1xuICAgIHRoaXMuX2Fib3V0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihpbmZvKTtcbiAgICB0aGlzLl9hdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGF2YXRhcik7XG4gIH1cbiAgc2V0VXNlckF2YXRhcihkYXRhKSB7XG4gICAgdGhpcy5fYXZhdGFyLnNyYyA9IGRhdGE7XG4gIH1cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgdGhpcy5fZGF0YSA9IHtcbiAgICAgIG5hbWU6IHRoaXMuX25hbWUudGV4dENvbnRlbnQsXG4gICAgICBhYm91dDogdGhpcy5fYWJvdXQudGV4dENvbnRlbnQsXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5fZGF0YTtcbiAgfVxuICBzZXRVc2VySW5mbyhkYXRhKSB7XG4gICAgdGhpcy5fbmFtZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICB0aGlzLl9hYm91dC50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJDYXJkIiwiY29uc3RydWN0b3IiLCJ0ZW1wbGF0ZSIsImRhdGEiLCJoYW5kbGVDYXJkQ2xpY2siLCJoYW5kbGVDYXJkRGVsZXRlIiwiaGFuZGxlQ2FyZExpa2UiLCJ0aGlzIiwiX3RlbXBsYXRlIiwiX25hbWUiLCJuYW1lIiwiX2xpbmsiLCJsaW5rIiwiX2hhbmRsZUNhcmRDbGljayIsIl9oYW5kbGVDYXJkTGlrZSIsIl9oYW5kbGVDYXJkRGVsZXRlIiwiX2xpa2VzIiwibGlrZXMiLCJfb3duZXIiLCJvd25lciIsIl9pZCIsIl9oYW5kbGVEZWxldGVCdXR0b25WaXNpYmlsaXR5IiwidXNlciIsIl9kZWxldGVCdXR0b24iLCJzdHlsZSIsImRpc3BsYXkiLCJkZWxldGVDYXJkIiwiX2NhcmRFbGVtZW50IiwicmVtb3ZlIiwidXBkYXRlTGlrZXMiLCJyZXMiLCJfbGlrZUNvdW50ZXIiLCJ0ZXh0Q29udGVudCIsImxlbmd0aCIsIl9saWtlQnV0dG9uIiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwiZ2V0TGlrZXNDb3VudCIsInNvbWUiLCJlbCIsImFkZCIsIl9nZXRUZW1wbGF0ZSIsInF1ZXJ5U2VsZWN0b3IiLCJjbG9uZU5vZGUiLCJfaGFuZGxlTGlrZUJ1dHRvbiIsImlzTGlrZWQiLCJjb250YWlucyIsIl9zZXRFdmVudExpc3RlbmVycyIsImFkZEV2ZW50TGlzdGVuZXIiLCJfY2FyZFBpY3R1cmUiLCJnZW5lcmF0ZUNhcmQiLCJfY2FyZCIsInNyYyIsImFsdCIsIkZvcm1WYWxpZGF0b3IiLCJmb3JtIiwic2V0dGluZ3MiLCJfc2V0dGluZ3MiLCJfZm9ybSIsIl9zaG93SW5wdXRFcnJvciIsImlucHV0IiwiX2Vycm9yIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hpZGVJbnB1dEVycm9yIiwiX2hhc0ludmFsaWRJbnB1dCIsImlucHV0cyIsInZhbGlkaXR5IiwidmFsaWQiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJfaW5wdXRzIiwiX2J1dHRvbiIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJkaXNhYmxlZCIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJmb3JFYWNoIiwiZW5hYmxlVmFsaWRhdGlvbiIsImV2dCIsInByZXZlbnREZWZhdWx0IiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwia2V5IiwiY2xvc2UiLCJfcG9wdXAiLCJkb2N1bWVudCIsImhhbmRsZUJ1dHRvblRleHQiLCJ0ZXh0Iiwib3BlbiIsIl9oYW5kbGVFc2NDbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRFdmVudExpc3RlbmVycyIsInRhcmdldCIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVTdWJtaXQiLCJzdXBlciIsIl9oYW5kbGVTdWJtaXQiLCJfZGF0YSIsIl9nZXRJbnB1dFZhbHVlcyIsInZhbHVlIiwicmVzZXQiLCJ2YWxpZGF0ZVNlbGVjdG9ycyIsImZvcm1TZWxlY3RvciIsImVkaXRCdXR0b24iLCJuYW1lSW5wdXQiLCJwcm9mSW5wdXQiLCJmb3JtVXNlckVsZW1lbnQiLCJmb3JtUGxhY2VFbGVtZW50IiwiZm9ybUF2YXRhckVsZW1lbnQiLCJhZGRQbGFjZUJ1dHRvbiIsImVkaXRBdmF0YXJCdXR0b24iLCJjYXJkVGVtcGxhdGUiLCJjb250ZW50IiwiY3VycmVudFVzZXIiLCJwbGFjZVZhbGlkYXRvciIsImF2YXRhclZhbGlkYXRvciIsImFwaSIsImJhc2VVcmwiLCJoZWFkZXJzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsImFkZExpa2UiLCJjYXJkIiwiZmV0Y2giLCJtZXRob2QiLCJ0aGVuIiwiX2NoZWNrUmVzcG9uc2UiLCJyZW1vdmVMaWtlIiwiZWRpdEF2YXRhciIsInZhbHVlcyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiYXZhdGFyIiwiZWRpdFByb2ZpbGUiLCJhYm91dCIsInByb2Zlc3Npb24iLCJhZGRDYXJkIiwicGxhY2UiLCJ1cmwiLCJnZXRVc2VySW5mbyIsImdldEluaXRpYWxDYXJkcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJhdXRob3JpemF0aW9uIiwicG9wdXBXaXRoUHJvZmlsZUZvcm0iLCJ1c2VySW5mbyIsInNldFVzZXJJbmZvIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibG9nIiwiZmluYWxseSIsInBvcHVwV2l0aERlbGV0ZUZvcm0iLCJvcGVuRm9yRGVsZXRlIiwiY2FyZElkIiwicG9wdXBXaXRoQWRkQ2FyZEZvcm0iLCJjYXJkR2FsbGVyeSIsImFkZEl0ZW0iLCJwb3B1cFdpdGhFZGl0QXZhdGFyRm9ybSIsInNldFVzZXJBdmF0YXIiLCJwb3B1cFdpdGhJbWFnZSIsIl9waWN0dXJlIiwiX3RpdGxlIiwiY29udGFpbmVyU2VsZWN0b3IiLCJyZW5kZXJlciIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJpdGVtIiwicHJlcGVuZCIsInJlbmRlckl0ZW1zIiwiY2FyZEVsZW1lbnQiLCJjcmVhdGVDYXJkIiwiaW5mbyIsIl9hYm91dCIsIl9hdmF0YXIiLCJhbGwiLCJjYXJkcyIsInVzZXJEYXRhIl0sInNvdXJjZVJvb3QiOiIifQ==