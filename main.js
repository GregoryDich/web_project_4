!function(){"use strict";class e{constructor(e,t){let{data:s,handleCardClick:r,handleCardDelete:n,handleCardLike:i}=e;this._template=t,this._name=s.name,this._link=s.link,this._handleCardClick=r,this._handleCardLike=i,this._handleCardDelete=n,this._likes=s.likes,this._owner=s.owner._id,this._id=s._id}_handleDeleteButtonVisibility(e){this._owner!==e._id&&(this._deleteButton.style.display="none")}deleteCard(){this._cardElement.remove()}updateLikes(e){this._likeCounter.textContent=e.likes.length,this._likeButton.classList.toggle("card__like-button_active")}getLikesCount(e){this._likes.some((t=>t._id===e._id))&&this._likeButton.classList.add("card__like-button_active"),this._likeCounter.textContent=this._likes.length<1?"":this._likes.length}_getTemplate(){return this._cardElement=this._template.querySelector(".card").cloneNode(!0),this._cardElement}_handleLikeButton(){const e=this._likeButton.classList.contains("card__like-button_active");this._handleCardLike(e,this)}_setEventListeners(){this._card.querySelector(".card__like-button").addEventListener("click",(()=>{this._handleLikeButton()})),this._deleteButton.addEventListener("click",(()=>{this._handleCardDelete(this)})),this._cardPicture.addEventListener("click",(()=>this._handleCardClick({name:this._name,link:this._link})))}generateCard(e){return this._card=this._getTemplate(),this._cardPicture=this._card.querySelector(".card__image"),this._cardPicture.src=this._link,this._deleteButton=this._card.querySelector(".card__delete-button"),this._likeCounter=this._card.querySelector(".card__like-counter"),this._likeButton=this._card.querySelector(".card__like-button"),this.getLikesCount(e),this._handleDeleteButtonVisibility(e),this._cardPicture.alt=this._name+" photo",this._card.querySelector(".card__description").textContent=this._name,this._setEventListeners(e),this._card}}class t{constructor(e,t){this._settings=t,this._form=e}_showInputError(e){this._error=this._form.querySelector(".".concat(e.name,"-input-error")),e.classList.add(this._settings.inputErrorClass),this._error.classList.add(this._settings.errorClass),this._error.textContent=e.validationMessage}_hideInputError(e){this._error=this._form.querySelector(".".concat(e.name,"-input-error")),e.classList.remove(this._settings.inputErrorClass),this._error.classList.remove(this._settings.errorClass),this._error.textContent=""}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}toggleButtonState(){this._hasInvalidInput(this._inputs)?(this._button.classList.add(this._settings.inactiveButtonClass),this._button.disabled=!0):(this._button.classList.remove(this._settings.inactiveButtonClass),this._button.disabled=!1)}_setEventListeners(){this._button=this._form.querySelector(this._settings.submitButtonSelector),this._inputs=Array.from(this._form.querySelectorAll(this._settings.inputSelector)),this.toggleButtonState(),this._inputs.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this.toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}class s{constructor(e){var t,s;s=e=>{"Escape"===e.key&&this.close()},(t="_handleEscClose")in this?Object.defineProperty(this,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[t]=s,this._popup=document.querySelector(e)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popup.addEventListener("click",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class r extends s{constructor(e,t){super(e),this._handleSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._data={}}_getInputValues(){return this._popup.querySelectorAll(".popup__form-input").forEach((e=>{this._data[e.name]=e.value})),this._data}openForDelete(e){super.open(),e&&(this._data=e)}close(){super.close(),this._form.reset()}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(e=>{this._data=this._getInputValues(),e.preventDefault(),this._handleSubmit(this._data),this.close()}))}}const n={formSelector:".popup__form",inputSelector:".popup__form-input",submitButtonSelector:".popup__form-button",inactiveButtonClass:"popup__form-button_disabled",inputErrorClass:"popup__form-input_type_error",errorClass:"popup__error_active"},i=document.querySelector(".user__edit-button"),a=document.querySelector(".popup__form-input_type_name"),o=document.querySelector(".popup__form-input_type_profession"),c=document.querySelector(".popup__form_type_profile"),h=document.querySelector(".popup__form_type_place"),_=document.querySelector(".popup__form_type_avatar"),l=document.querySelector(".user__add-button"),d=document.querySelector(".user__avatar_overlay"),u=document.querySelector("#template").content;let p={};new t(c,n).enableValidation();const m=new t(h,n);m.enableValidation();const v=new t(_,n);v.enableValidation();const k=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}addLike(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e._id),{method:"PUT",headers:this._headers}).then((e=>this._checkResponse(e)))}removeLike(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e._id),{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e)))}editAvatar(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatar})}).then((e=>this._checkResponse(e)))}editProfile(e){return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.profession})}).then((e=>this._checkResponse(e)))}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e._id),{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e)))}addCard(e){return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.place,link:e.url})}).then((e=>this._checkResponse(e)))}getUserInfo(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>this._checkResponse(e)))}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((e=>this._checkResponse(e)))}_checkResponse(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"545ebbe5-83ef-479f-9e3a-79ad4591aa10","Content-Type":"application/json"}}),f=new r(".popup_type_profile",(function(e){k.editProfile(e).then((e=>{E.setUserInfo(e)})).catch((e=>console.log(e)))}));f.setEventListeners();const y=new r(".popup_type_delete",(function(e){k.deleteCard(e).then((t=>{e.deleteCard()}))}));y.setEventListeners();const b=new r(".popup_type_place",(function(e){k.addCard(e).then((e=>{L.addItem(e)})).catch((e=>console.log(e)))}));b.setEventListeners();const g=new r(".popup_type_avatar",(function(e){k.editAvatar(e).then((e=>E.setUserAvatar(e.avatar))).catch((e=>console.log(e)))}));g.setEventListeners();const C=new class extends s{open(e){let{name:t,link:s}=e;super.open(),this._picture=this._popup.querySelector(".popup__image"),this._picture.src=s,this._picture.alt=t+" photo",this._title=this._popup.querySelector(".popup__image-title"),this._title.textContent=t}}(".popup_type_image");C.setEventListeners();const L=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}addItem(e){const t=this._renderer(e);this._container.prepend(t)}renderItems(e){Array.from(e).forEach((e=>{this.addItem(e)}))}}({renderer:t=>function(t){let{item:s}=t;return new e({data:s,handleCardClick:e=>{let{name:t,link:s}=e;C.open({name:t,link:s})},handleCardDelete:e=>{y.openForDelete(e)},handleCardLike:(e,t)=>{e?k.removeLike(t).then((e=>{t.updateLikes(e)})).catch((e=>console.log(e))):k.addLike(t).then((e=>{t.updateLikes(e)})).catch((e=>console.log(e)))}},u).generateCard(p)}({item:t})},".gallery"),E=new class{constructor(e){let{name:t,info:s,avatar:r}=e;this._name=document.querySelector(t),this._about=document.querySelector(s),this._avatar=document.querySelector(r)}setUserAvatar(e){this._avatar.src=e}getUserInfo(){return this._data={name:this._name.textContent,about:this._about.textContent},this._data}setUserInfo(e){this._name.textContent=e.name,this._about.textContent=e.about}}({name:".user__name",info:".user__profession",avatar:".user__avatar-image"});Promise.all([k.getUserInfo(),k.getInitialCards()]).then((e=>{let[t,s]=e;p=t,E.setUserInfo(t),E.setUserAvatar(t.avatar),L.renderItems(s)})).catch((e=>console.log(e))),i.addEventListener("click",(()=>{f.open();const e=E.getUserInfo();a.value=e.name,o.value=e.about})),l.addEventListener("click",(()=>{b.open(),m.toggleButtonState()})),d.addEventListener("click",(()=>{g.open(),v.toggleButtonState()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RCxjQUFjZ0csR0FFeEMyQixjQUFjbEssR0FDWkksS0FBSzZLLFFBQVFoSSxJQUFNakQsRUFFckI4SSxjQUtFLE9BSkExSSxLQUFLNkYsTUFBUSxDQUNYMUYsS0FBTUgsS0FBS0UsTUFBTXVCLFlBQ2pCNEcsTUFBT3JJLEtBQUs0SyxPQUFPbkosYUFFZHpCLEtBQUs2RixNQUVkdUQsWUFBWXhKLEdBQ1ZJLEtBQUtFLE1BQU11QixZQUFjN0IsRUFBS08sS0FDOUJILEtBQUs0SyxPQUFPbkosWUFBYzdCLEVBQUt5SSxRSnNFTCxDQUM1QmxJLEtBQU0sY0FDTndLLEtBQU0sb0JBQ054QyxPQUFRLHdCQUtWVyxRQUFRZ0MsSUFBSSxDQUFDNUQsRUFBSXdCLGNBQWV4QixFQUFJeUIsb0JBQ2pDaEIsTUFBSyxJQUFtQixJQUFqQjVHLEVBQU1nSyxHQUFXLEVBQ3ZCaEUsRUFBY2hHLEVBQ2RvSSxFQUFTQyxZQUFZckksR0FDckJvSSxFQUFTVyxjQUFjL0ksRUFBS29ILFFBQzVCd0IsRUFBWWEsWUFBWU8sTUFFekIxQixPQUFPQyxHQUFRQyxRQUFRQyxJQUFJRixLQWdFOUJqRCxFQUFXM0QsaUJBQWlCLFNBQVMsS0FDbkN3RyxFQUFxQjlELE9BQ3JCLE1BQU00RixFQUFXN0IsRUFBU1QsY0FDMUJwQyxFQUFVUCxNQUFRaUYsRUFBUzdLLEtBQzNCb0csRUFBVVIsTUFBUWlGLEVBQVMzQyxTQUU3QjFCLEVBQWVqRSxpQkFBaUIsU0FBUyxLQUN2Q2dILEVBQXFCdEUsT0FDckI0QixFQUFlaEQsdUJBRWpCNEMsRUFBaUJsRSxpQkFBaUIsU0FBUyxLQUN6Q21ILEVBQXdCekUsT0FDeEI2QixFQUFnQmpELHVCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXJvdW5kdXMvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL2Fyb3VuZHVzLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9hcm91bmR1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL2Fyb3VuZHVzLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly9hcm91bmR1cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9hcm91bmR1cy8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly9hcm91bmR1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL2Fyb3VuZHVzLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly9hcm91bmR1cy8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xuICBjb25zdHJ1Y3RvcihcbiAgICB7IGRhdGEsIGhhbmRsZUNhcmRDbGljaywgaGFuZGxlQ2FyZERlbGV0ZSwgaGFuZGxlQ2FyZExpa2UgfSxcbiAgICB0ZW1wbGF0ZVxuICApIHtcbiAgICB0aGlzLl90ZW1wbGF0ZSA9IHRlbXBsYXRlO1xuICAgIHRoaXMuX25hbWUgPSBkYXRhLm5hbWU7XG4gICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcbiAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgPSBoYW5kbGVDYXJkQ2xpY2s7XG4gICAgdGhpcy5faGFuZGxlQ2FyZExpa2UgPSBoYW5kbGVDYXJkTGlrZTtcbiAgICB0aGlzLl9oYW5kbGVDYXJkRGVsZXRlID0gaGFuZGxlQ2FyZERlbGV0ZTtcbiAgICB0aGlzLl9saWtlcyA9IGRhdGEubGlrZXM7XG4gICAgdGhpcy5fb3duZXIgPSBkYXRhLm93bmVyLl9pZDtcbiAgICB0aGlzLl9pZCA9IGRhdGEuX2lkO1xuICB9XG4gIF9oYW5kbGVEZWxldGVCdXR0b25WaXNpYmlsaXR5KHVzZXIpIHtcbiAgICBpZiAodGhpcy5fb3duZXIgIT09IHVzZXIuX2lkKSB7XG4gICAgICB0aGlzLl9kZWxldGVCdXR0b24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIH1cbiAgfVxuICBkZWxldGVDYXJkKCkge1xuICAgIHRoaXMuX2NhcmRFbGVtZW50LnJlbW92ZSgpO1xuICB9XG4gIHVwZGF0ZUxpa2VzKHJlcykge1xuICAgIHRoaXMuX2xpa2VDb3VudGVyLnRleHRDb250ZW50ID0gcmVzLmxpa2VzLmxlbmd0aDtcbiAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gIH1cbiAgZ2V0TGlrZXNDb3VudCh1c2VyKSB7XG4gICAgdGhpcy5fbGlrZXMuc29tZSgoZWwpID0+IGVsLl9pZCA9PT0gdXNlci5faWQpICYmXG4gICAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gICAgdGhpcy5fbGlrZUNvdW50ZXIudGV4dENvbnRlbnQgPVxuICAgICAgdGhpcy5fbGlrZXMubGVuZ3RoIDwgMSA/IFwiXCIgOiB0aGlzLl9saWtlcy5sZW5ndGg7XG4gIH1cbiAgX2dldFRlbXBsYXRlKCkge1xuICAgIHRoaXMuX2NhcmRFbGVtZW50ID0gdGhpcy5fdGVtcGxhdGUucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpLmNsb25lTm9kZSh0cnVlKTtcbiAgICByZXR1cm4gdGhpcy5fY2FyZEVsZW1lbnQ7XG4gIH1cbiAgX2hhbmRsZUxpa2VCdXR0b24oKSB7XG4gICAgY29uc3QgaXNMaWtlZCA9IHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKFxuICAgICAgXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIlxuICAgICk7XG4gICAgdGhpcy5faGFuZGxlQ2FyZExpa2UoaXNMaWtlZCwgdGhpcyk7XG4gIH1cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2NhcmRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5faGFuZGxlTGlrZUJ1dHRvbigpO1xuICAgICAgfSk7XG4gICAgdGhpcy5fZGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVDYXJkRGVsZXRlKHRoaXMpO1xuICAgIH0pO1xuICAgIHRoaXMuX2NhcmRQaWN0dXJlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrKHtcbiAgICAgICAgbmFtZTogdGhpcy5fbmFtZSxcbiAgICAgICAgbGluazogdGhpcy5fbGluayxcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuICBnZW5lcmF0ZUNhcmQodXNlcikge1xuICAgIHRoaXMuX2NhcmQgPSB0aGlzLl9nZXRUZW1wbGF0ZSgpO1xuICAgIHRoaXMuX2NhcmRQaWN0dXJlID0gdGhpcy5fY2FyZC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICAgIHRoaXMuX2NhcmRQaWN0dXJlLnNyYyA9IHRoaXMuX2xpbms7XG4gICAgdGhpcy5fZGVsZXRlQnV0dG9uID0gdGhpcy5fY2FyZC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIik7XG4gICAgdGhpcy5fbGlrZUNvdW50ZXIgPSB0aGlzLl9jYXJkLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1jb3VudGVyXCIpO1xuICAgIHRoaXMuX2xpa2VCdXR0b24gPSB0aGlzLl9jYXJkLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XG4gICAgdGhpcy5nZXRMaWtlc0NvdW50KHVzZXIpO1xuICAgIHRoaXMuX2hhbmRsZURlbGV0ZUJ1dHRvblZpc2liaWxpdHkodXNlcik7XG4gICAgdGhpcy5fY2FyZFBpY3R1cmUuYWx0ID0gdGhpcy5fbmFtZSArIFwiIHBob3RvXCI7XG4gICAgdGhpcy5fY2FyZC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2Rlc2NyaXB0aW9uXCIpLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycyh1c2VyKTtcbiAgICByZXR1cm4gdGhpcy5fY2FyZDtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XG4gIGNvbnN0cnVjdG9yKGZvcm0sIHNldHRpbmdzKSB7XG4gICAgdGhpcy5fc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICB0aGlzLl9mb3JtID0gZm9ybTtcbiAgfVxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXQpIHtcbiAgICB0aGlzLl9lcnJvciA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihgLiR7aW5wdXQubmFtZX0taW5wdXQtZXJyb3JgKTtcbiAgICBpbnB1dC5jbGFzc0xpc3QuYWRkKHRoaXMuX3NldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XG4gICAgdGhpcy5fZXJyb3IuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5lcnJvckNsYXNzKTtcbiAgICB0aGlzLl9lcnJvci50ZXh0Q29udGVudCA9IGlucHV0LnZhbGlkYXRpb25NZXNzYWdlO1xuICB9XG4gIF9oaWRlSW5wdXRFcnJvcihpbnB1dCkge1xuICAgIHRoaXMuX2Vycm9yID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dC5uYW1lfS1pbnB1dC1lcnJvcmApO1xuICAgIGlucHV0LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcbiAgICB0aGlzLl9lcnJvci5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmVycm9yQ2xhc3MpO1xuICAgIHRoaXMuX2Vycm9yLnRleHRDb250ZW50ID0gXCJcIjtcbiAgfVxuICBfaGFzSW52YWxpZElucHV0KGlucHV0cykge1xuICAgIHJldHVybiBpbnB1dHMuc29tZSgoaW5wdXQpID0+IHtcbiAgICAgIHJldHVybiAhaW5wdXQudmFsaWRpdHkudmFsaWQ7XG4gICAgfSk7XG4gIH1cbiAgX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dCkge1xuICAgIGlmIChpbnB1dC52YWxpZGl0eS52YWxpZCkge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dCk7XG4gICAgfVxuICB9XG4gIHRvZ2dsZUJ1dHRvblN0YXRlKCkge1xuICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQodGhpcy5faW5wdXRzKSkge1xuICAgICAgdGhpcy5fYnV0dG9uLmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICB0aGlzLl9idXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9idXR0b24uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgIHRoaXMuX2J1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fYnV0dG9uID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKFxuICAgICAgdGhpcy5fc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3JcbiAgICApO1xuICAgIHRoaXMuX2lucHV0cyA9IEFycmF5LmZyb20oXG4gICAgICB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5fc2V0dGluZ3MuaW5wdXRTZWxlY3RvcilcbiAgICApO1xuICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgICB0aGlzLl9pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dCk7XG4gICAgICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0pO1xuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgIHRoaXMuX3BvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcbiAgfVxuICBvcGVuKCkge1xuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuZWRcIik7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICB9XG4gIGNsb3NlKCkge1xuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9vcGVuZWRcIik7XG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICB9XG4gIF9oYW5kbGVFc2NDbG9zZSA9IChldnQpID0+IHtcbiAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfTtcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9vcGVuZWRcIikgfHxcbiAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9fY2xvc2UtYnV0dG9uXCIpXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaGFuZGxlU3VibWl0KSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5faGFuZGxlU3VibWl0ID0gaGFuZGxlU3VibWl0O1xuICAgIHRoaXMuX2Zvcm0gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xuICAgIHRoaXMuX2RhdGEgPSB7fTtcbiAgfVxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XG4gICAgY29uc3QgaW5wdXRzID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvckFsbChcIi5wb3B1cF9fZm9ybS1pbnB1dFwiKTtcbiAgICBpbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIHRoaXMuX2RhdGFbaW5wdXQubmFtZV0gPSBpbnB1dC52YWx1ZTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcy5fZGF0YTtcbiAgfVxuICBvcGVuRm9yRGVsZXRlKGNhcmRJZCkge1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgICBpZiAoY2FyZElkKSB7XG4gICAgICB0aGlzLl9kYXRhID0gY2FyZElkO1xuICAgIH1cbiAgfVxuICBjbG9zZSgpIHtcbiAgICBzdXBlci5jbG9zZSgpO1xuICAgIHRoaXMuX2Zvcm0ucmVzZXQoKTtcbiAgfVxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX3BvcHVwLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICAgICAgdGhpcy5fZGF0YSA9IHRoaXMuX2dldElucHV0VmFsdWVzKCk7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCh0aGlzLl9kYXRhKTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9KTtcbiAgfVxufVxuIiwiLy9pbXBvcnRzXG5cbmltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xuaW1wb3J0IFBvcHVwRm9yRGVsZXRlIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwRm9yRGVsZXRlLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xuXG4vL3NldHRpbmdzXG5cbmNvbnN0IHZhbGlkYXRlU2VsZWN0b3JzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLnBvcHVwX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19mb3JtLWlucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybS1idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fZm9ybS1idXR0b25fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19mb3JtLWlucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJwb3B1cF9fZXJyb3JfYWN0aXZlXCIsXG59O1xuXG4vL3ZhcmlhYmxlc1xuXG5jb25zdCBlZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi51c2VyX19lZGl0LWJ1dHRvblwiKTtcbmNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm0taW5wdXRfdHlwZV9uYW1lXCIpO1xuY29uc3QgcHJvZklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybS1pbnB1dF90eXBlX3Byb2Zlc3Npb25cIik7XG5jb25zdCBmb3JtVXNlckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtX3R5cGVfcHJvZmlsZVwiKTtcbmNvbnN0IGZvcm1QbGFjZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtX3R5cGVfcGxhY2VcIik7XG5jb25zdCBmb3JtQXZhdGFyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1fdHlwZV9hdmF0YXJcIik7XG5jb25zdCBhZGRQbGFjZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudXNlcl9fYWRkLWJ1dHRvblwiKTtcbmNvbnN0IGVkaXRBdmF0YXJCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnVzZXJfX2F2YXRhcl9vdmVybGF5XCIpO1xuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN0ZW1wbGF0ZVwiKS5jb250ZW50O1xubGV0IGN1cnJlbnRVc2VyID0ge307XG5cbi8vdmFsaWRhdG9yc1xuXG5jb25zdCBwcm9maWxlVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybVVzZXJFbGVtZW50LCB2YWxpZGF0ZVNlbGVjdG9ycyk7XG5wcm9maWxlVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuY29uc3QgcGxhY2VWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihmb3JtUGxhY2VFbGVtZW50LCB2YWxpZGF0ZVNlbGVjdG9ycyk7XG5wbGFjZVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbmNvbnN0IGF2YXRhclZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1BdmF0YXJFbGVtZW50LCB2YWxpZGF0ZVNlbGVjdG9ycyk7XG5hdmF0YXJWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG4vL2NsYXNzIGluc3RhbmNlc1xuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9jb2hvcnQtMy1lblwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCI1NDVlYmJlNS04M2VmLTQ3OWYtOWUzYS03OWFkNDU5MWFhMTBcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG5jb25zdCBwb3B1cFdpdGhQcm9maWxlRm9ybSA9IG5ldyBQb3B1cFdpdGhGb3JtKFxuICBcIi5wb3B1cF90eXBlX3Byb2ZpbGVcIixcbiAgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXRcbik7XG5wb3B1cFdpdGhQcm9maWxlRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBwb3B1cFdpdGhEZWxldGVGb3JtID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gIFwiLnBvcHVwX3R5cGVfZGVsZXRlXCIsXG4gIGhhbmRsZURlbGV0ZUZvcm1TdWJtaXRcbik7XG5wb3B1cFdpdGhEZWxldGVGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IHBvcHVwV2l0aEFkZENhcmRGb3JtID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gIFwiLnBvcHVwX3R5cGVfcGxhY2VcIixcbiAgaGFuZGxlUGxhY2VGb3JtU3VibWl0XG4pO1xucG9wdXBXaXRoQWRkQ2FyZEZvcm0uc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3QgcG9wdXBXaXRoRWRpdEF2YXRhckZvcm0gPSBuZXcgUG9wdXBXaXRoRm9ybShcbiAgXCIucG9wdXBfdHlwZV9hdmF0YXJcIixcbiAgaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdFxuKTtcbnBvcHVwV2l0aEVkaXRBdmF0YXJGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IHBvcHVwV2l0aEltYWdlID0gbmV3IFBvcHVwV2l0aEltYWdlKFwiLnBvcHVwX3R5cGVfaW1hZ2VcIik7XG5wb3B1cFdpdGhJbWFnZS5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBjYXJkR2FsbGVyeSA9IG5ldyBTZWN0aW9uKFxuICB7IHJlbmRlcmVyOiAoaXRlbSkgPT4gY3JlYXRlQ2FyZCh7IGl0ZW0gfSkgfSxcbiAgXCIuZ2FsbGVyeVwiXG4pO1xuXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XG4gIG5hbWU6IFwiLnVzZXJfX25hbWVcIixcbiAgaW5mbzogXCIudXNlcl9fcHJvZmVzc2lvblwiLFxuICBhdmF0YXI6IFwiLnVzZXJfX2F2YXRhci1pbWFnZVwiLFxufSk7XG5cbi8vYXBpIGNhbGxzXG5cblByb21pc2UuYWxsKFthcGkuZ2V0VXNlckluZm8oKSwgYXBpLmdldEluaXRpYWxDYXJkcygpXSlcbiAgLnRoZW4oKFt1c2VyLCBjYXJkc10pID0+IHtcbiAgICBjdXJyZW50VXNlciA9IHVzZXI7XG4gICAgdXNlckluZm8uc2V0VXNlckluZm8odXNlcik7XG4gICAgdXNlckluZm8uc2V0VXNlckF2YXRhcih1c2VyLmF2YXRhcik7XG4gICAgY2FyZEdhbGxlcnkucmVuZGVySXRlbXMoY2FyZHMpO1xuICB9KVxuICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSk7XG5cbi8vZnVuY3Rpb25zXG5cbmZ1bmN0aW9uIGhhbmRsZUF2YXRhckZvcm1TdWJtaXQodmFsdWVzKSB7XG4gIGFwaVxuICAgIC5lZGl0QXZhdGFyKHZhbHVlcylcbiAgICAudGhlbigocmVzKSA9PiB1c2VySW5mby5zZXRVc2VyQXZhdGFyKHJlcy5hdmF0YXIpKVxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKTtcbn1cbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KHZhbHVlcykge1xuICBhcGlcbiAgICAuZWRpdFByb2ZpbGUodmFsdWVzKVxuICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHJlcyk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSk7XG59XG5mdW5jdGlvbiBoYW5kbGVEZWxldGVGb3JtU3VibWl0KGNhcmQpIHtcbiAgYXBpLmRlbGV0ZUNhcmQoY2FyZCkudGhlbigocmVzKSA9PiB7XG4gICAgY2FyZC5kZWxldGVDYXJkKCk7XG4gIH0pO1xufVxuZnVuY3Rpb24gaGFuZGxlUGxhY2VGb3JtU3VibWl0KHZhbHVlcykge1xuICBhcGlcbiAgICAuYWRkQ2FyZCh2YWx1ZXMpXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgY2FyZEdhbGxlcnkuYWRkSXRlbShyZXMpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpO1xufVxuZnVuY3Rpb24gY3JlYXRlQ2FyZCh7IGl0ZW0gfSkge1xuICBjb25zdCBjYXJkSW5zdGFuY2UgPSBuZXcgQ2FyZChcbiAgICB7XG4gICAgICBkYXRhOiBpdGVtLFxuICAgICAgaGFuZGxlQ2FyZENsaWNrOiAoeyBuYW1lLCBsaW5rIH0pID0+IHtcbiAgICAgICAgcG9wdXBXaXRoSW1hZ2Uub3Blbih7IG5hbWUsIGxpbmsgfSk7XG4gICAgICB9LFxuICAgICAgaGFuZGxlQ2FyZERlbGV0ZTogKGNhcmRFbGVtZW50KSA9PiB7XG4gICAgICAgIHBvcHVwV2l0aERlbGV0ZUZvcm0ub3BlbkZvckRlbGV0ZShjYXJkRWxlbWVudCk7XG4gICAgICB9LFxuICAgICAgaGFuZGxlQ2FyZExpa2U6IChpc0xpa2VkLCBkYXRhKSA9PiB7XG4gICAgICAgIGlzTGlrZWRcbiAgICAgICAgICA/IGFwaVxuICAgICAgICAgICAgICAucmVtb3ZlTGlrZShkYXRhKVxuICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgZGF0YS51cGRhdGVMaWtlcyhyZXMpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcbiAgICAgICAgICA6IGFwaVxuICAgICAgICAgICAgICAuYWRkTGlrZShkYXRhKVxuICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgZGF0YS51cGRhdGVMaWtlcyhyZXMpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSk7XG4gICAgICB9LFxuICAgIH0sXG4gICAgY2FyZFRlbXBsYXRlXG4gICk7XG4gIGNvbnN0IGNhcmQgPSBjYXJkSW5zdGFuY2UuZ2VuZXJhdGVDYXJkKGN1cnJlbnRVc2VyKTtcbiAgcmV0dXJuIGNhcmQ7XG59XG5cbi8vZXZlbnQgbGlzdGVuZXJzXG5lZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHBvcHVwV2l0aFByb2ZpbGVGb3JtLm9wZW4oKTtcbiAgY29uc3QgdXNlckRhdGEgPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xuICBuYW1lSW5wdXQudmFsdWUgPSB1c2VyRGF0YS5uYW1lO1xuICBwcm9mSW5wdXQudmFsdWUgPSB1c2VyRGF0YS5hYm91dDtcbn0pO1xuYWRkUGxhY2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgcG9wdXBXaXRoQWRkQ2FyZEZvcm0ub3BlbigpO1xuICBwbGFjZVZhbGlkYXRvci50b2dnbGVCdXR0b25TdGF0ZSgpO1xufSk7XG5lZGl0QXZhdGFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHBvcHVwV2l0aEVkaXRBdmF0YXJGb3JtLm9wZW4oKTtcbiAgYXZhdGFyVmFsaWRhdG9yLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XG59KTtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cbiAgYWRkTGlrZShjYXJkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZC5faWR9YCwge1xuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKSk7XG4gIH1cbiAgcmVtb3ZlTGlrZShjYXJkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZC5faWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKSk7XG4gIH1cbiAgZWRpdEF2YXRhcih2YWx1ZXMpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXI6IHZhbHVlcy5hdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKSk7XG4gIH1cbiAgZWRpdFByb2ZpbGUodmFsdWVzKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lOiB2YWx1ZXMubmFtZSxcbiAgICAgICAgYWJvdXQ6IHZhbHVlcy5wcm9mZXNzaW9uLFxuICAgICAgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcykpO1xuICB9XG4gIGRlbGV0ZUNhcmQoY2FyZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmQuX2lkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcykpO1xuICB9XG4gIGFkZENhcmQodmFsdWVzKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWU6IHZhbHVlcy5wbGFjZSxcbiAgICAgICAgbGluazogdmFsdWVzLnVybCxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpKTtcbiAgfVxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpKTtcbiAgfVxuXG4gIGdldEluaXRpYWxDYXJkcygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpKTtcbiAgfVxuXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIH1cbn1cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcbiAgb3Blbih7IG5hbWUsIGxpbmsgfSkge1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgICB0aGlzLl9waWN0dXJlID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1hZ2VcIik7XG4gICAgdGhpcy5fcGljdHVyZS5zcmMgPSBsaW5rO1xuICAgIHRoaXMuX3BpY3R1cmUuYWx0ID0gbmFtZSArIFwiIHBob3RvXCI7XG4gICAgdGhpcy5fdGl0bGUgPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWFnZS10aXRsZVwiKTtcbiAgICB0aGlzLl90aXRsZS50ZXh0Q29udGVudCA9IG5hbWU7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xuICBjb25zdHJ1Y3Rvcih7IHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgfVxuICBhZGRJdGVtKGl0ZW0pIHtcbiAgICBjb25zdCBjYXJkID0gdGhpcy5fcmVuZGVyZXIoaXRlbSk7XG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoY2FyZCk7XG4gIH1cbiAgcmVuZGVySXRlbXMoZGF0YSkge1xuICAgIGNvbnN0IGNhcmRzID0gQXJyYXkuZnJvbShkYXRhKTtcbiAgICBjYXJkcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICB0aGlzLmFkZEl0ZW0oaXRlbSk7XG4gICAgfSk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcbiAgY29uc3RydWN0b3IoeyBuYW1lLCBpbmZvLCBhdmF0YXIgfSkge1xuICAgIHRoaXMuX25hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWUpO1xuICAgIHRoaXMuX2Fib3V0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihpbmZvKTtcbiAgICB0aGlzLl9hdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGF2YXRhcik7XG4gIH1cbiAgc2V0VXNlckF2YXRhcihkYXRhKSB7XG4gICAgdGhpcy5fYXZhdGFyLnNyYyA9IGRhdGE7XG4gIH1cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgdGhpcy5fZGF0YSA9IHtcbiAgICAgIG5hbWU6IHRoaXMuX25hbWUudGV4dENvbnRlbnQsXG4gICAgICBhYm91dDogdGhpcy5fYWJvdXQudGV4dENvbnRlbnQsXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5fZGF0YTtcbiAgfVxuICBzZXRVc2VySW5mbyhkYXRhKSB7XG4gICAgdGhpcy5fbmFtZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICB0aGlzLl9hYm91dC50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJDYXJkIiwiY29uc3RydWN0b3IiLCJ0ZW1wbGF0ZSIsImRhdGEiLCJoYW5kbGVDYXJkQ2xpY2siLCJoYW5kbGVDYXJkRGVsZXRlIiwiaGFuZGxlQ2FyZExpa2UiLCJ0aGlzIiwiX3RlbXBsYXRlIiwiX25hbWUiLCJuYW1lIiwiX2xpbmsiLCJsaW5rIiwiX2hhbmRsZUNhcmRDbGljayIsIl9oYW5kbGVDYXJkTGlrZSIsIl9oYW5kbGVDYXJkRGVsZXRlIiwiX2xpa2VzIiwibGlrZXMiLCJfb3duZXIiLCJvd25lciIsIl9pZCIsIl9oYW5kbGVEZWxldGVCdXR0b25WaXNpYmlsaXR5IiwidXNlciIsIl9kZWxldGVCdXR0b24iLCJzdHlsZSIsImRpc3BsYXkiLCJkZWxldGVDYXJkIiwiX2NhcmRFbGVtZW50IiwicmVtb3ZlIiwidXBkYXRlTGlrZXMiLCJyZXMiLCJfbGlrZUNvdW50ZXIiLCJ0ZXh0Q29udGVudCIsImxlbmd0aCIsIl9saWtlQnV0dG9uIiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwiZ2V0TGlrZXNDb3VudCIsInNvbWUiLCJlbCIsImFkZCIsIl9nZXRUZW1wbGF0ZSIsInF1ZXJ5U2VsZWN0b3IiLCJjbG9uZU5vZGUiLCJfaGFuZGxlTGlrZUJ1dHRvbiIsImlzTGlrZWQiLCJjb250YWlucyIsIl9zZXRFdmVudExpc3RlbmVycyIsIl9jYXJkIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9jYXJkUGljdHVyZSIsImdlbmVyYXRlQ2FyZCIsInNyYyIsImFsdCIsIkZvcm1WYWxpZGF0b3IiLCJmb3JtIiwic2V0dGluZ3MiLCJfc2V0dGluZ3MiLCJfZm9ybSIsIl9zaG93SW5wdXRFcnJvciIsImlucHV0IiwiX2Vycm9yIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hpZGVJbnB1dEVycm9yIiwiX2hhc0ludmFsaWRJbnB1dCIsImlucHV0cyIsInZhbGlkaXR5IiwidmFsaWQiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJfaW5wdXRzIiwiX2J1dHRvbiIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJkaXNhYmxlZCIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJmb3JFYWNoIiwiZW5hYmxlVmFsaWRhdGlvbiIsImV2dCIsInByZXZlbnREZWZhdWx0IiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwia2V5IiwiY2xvc2UiLCJfcG9wdXAiLCJkb2N1bWVudCIsIm9wZW4iLCJfaGFuZGxlRXNjQ2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJ0YXJnZXQiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlU3VibWl0Iiwic3VwZXIiLCJfaGFuZGxlU3VibWl0IiwiX2RhdGEiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJ2YWx1ZSIsIm9wZW5Gb3JEZWxldGUiLCJjYXJkSWQiLCJyZXNldCIsInZhbGlkYXRlU2VsZWN0b3JzIiwiZm9ybVNlbGVjdG9yIiwiZWRpdEJ1dHRvbiIsIm5hbWVJbnB1dCIsInByb2ZJbnB1dCIsImZvcm1Vc2VyRWxlbWVudCIsImZvcm1QbGFjZUVsZW1lbnQiLCJmb3JtQXZhdGFyRWxlbWVudCIsImFkZFBsYWNlQnV0dG9uIiwiZWRpdEF2YXRhckJ1dHRvbiIsImNhcmRUZW1wbGF0ZSIsImNvbnRlbnQiLCJjdXJyZW50VXNlciIsInBsYWNlVmFsaWRhdG9yIiwiYXZhdGFyVmFsaWRhdG9yIiwiYXBpIiwiYmFzZVVybCIsImhlYWRlcnMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiYWRkTGlrZSIsImNhcmQiLCJmZXRjaCIsIm1ldGhvZCIsInRoZW4iLCJfY2hlY2tSZXNwb25zZSIsInJlbW92ZUxpa2UiLCJlZGl0QXZhdGFyIiwidmFsdWVzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhdmF0YXIiLCJlZGl0UHJvZmlsZSIsImFib3V0IiwicHJvZmVzc2lvbiIsImFkZENhcmQiLCJwbGFjZSIsInVybCIsImdldFVzZXJJbmZvIiwiZ2V0SW5pdGlhbENhcmRzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImF1dGhvcml6YXRpb24iLCJwb3B1cFdpdGhQcm9maWxlRm9ybSIsInVzZXJJbmZvIiwic2V0VXNlckluZm8iLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJwb3B1cFdpdGhEZWxldGVGb3JtIiwicG9wdXBXaXRoQWRkQ2FyZEZvcm0iLCJjYXJkR2FsbGVyeSIsImFkZEl0ZW0iLCJwb3B1cFdpdGhFZGl0QXZhdGFyRm9ybSIsInNldFVzZXJBdmF0YXIiLCJwb3B1cFdpdGhJbWFnZSIsIl9waWN0dXJlIiwiX3RpdGxlIiwiY29udGFpbmVyU2VsZWN0b3IiLCJyZW5kZXJlciIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJpdGVtIiwicHJlcGVuZCIsInJlbmRlckl0ZW1zIiwiY2FyZEVsZW1lbnQiLCJjcmVhdGVDYXJkIiwiaW5mbyIsIl9hYm91dCIsIl9hdmF0YXIiLCJhbGwiLCJjYXJkcyIsInVzZXJEYXRhIl0sInNvdXJjZVJvb3QiOiIifQ==